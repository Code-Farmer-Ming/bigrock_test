var Builder={NODEMAP:{AREA:'map',CAPTION:'table',COL:'table',COLGROUP:'table',LEGEND:'fieldset',OPTGROUP:'select',OPTION:'select',PARAM:'object',TBODY:'table',TD:'table',TFOOT:'table',TH:'table',THEAD:'table',TR:'table'},node:function(elementName){elementName=elementName.toUpperCase();var parentTag=this.NODEMAP[elementName]||'div';var parentElement=document.createElement(parentTag);try{parentElement.innerHTML="<"+elementName+"></"+elementName+">";}catch(e){}
var element=parentElement.firstChild||null;if(element&&(element.tagName.toUpperCase()!=elementName))
element=element.getElementsByTagName(elementName)[0];if(!element)element=document.createElement(elementName);if(!element)return;if(arguments[1])
if(this._isStringOrNumber(arguments[1])||(arguments[1]instanceof Array)||arguments[1].tagName){this._children(element,arguments[1]);}else{var attrs=this._attributes(arguments[1]);if(attrs.length){try{parentElement.innerHTML="<"+elementName+" "+
attrs+"></"+elementName+">";}catch(e){}
element=parentElement.firstChild||null;if(!element){element=document.createElement(elementName);for(attr in arguments[1])
element[attr=='class'?'className':attr]=arguments[1][attr];}
if(element.tagName.toUpperCase()!=elementName)
element=parentElement.getElementsByTagName(elementName)[0];}}
if(arguments[2])
this._children(element,arguments[2]);return $(element);},_text:function(text){return document.createTextNode(text);},ATTR_MAP:{'className':'class','htmlFor':'for'},_attributes:function(attributes){var attrs=[];for(attribute in attributes)
attrs.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+attributes[attribute].toString().escapeHTML().gsub(/"/,'&quot;')+'"');return attrs.join(" ");},_children:function(element,children){if(children.tagName){element.appendChild(children);return;}
if(typeof children=='object'){children.flatten().each(function(e){if(typeof e=='object')
element.appendChild(e);else
if(Builder._isStringOrNumber(e))
element.appendChild(Builder._text(e));});}else
if(Builder._isStringOrNumber(children))
element.appendChild(Builder._text(children));},_isStringOrNumber:function(param){return(typeof param=='string'||typeof param=='number');},build:function(html){var element=this.node('div');$(element).update(html.strip());return element.down();},dump:function(scope){if(typeof scope!='object'&&typeof scope!='function')scope=window;var tags=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY "+"BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET "+"FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX "+"KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P "+"PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD "+"TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);tags.each(function(tag){scope[tag]=function(){return Builder.node.apply(Builder,[tag].concat($A(arguments)));};});}};String.prototype.parseColor=function(){var color='#';if(this.slice(0,4)=='rgb('){var cols=this.slice(4,this.length-1).split(',');var i=0;do{color+=parseInt(cols[i]).toColorPart()}while(++i<3);}else{if(this.slice(0,1)=='#'){if(this.length==4)for(var i=1;i<4;i++)color+=(this.charAt(i)+this.charAt(i)).toLowerCase();if(this.length==7)color=this.toLowerCase();}}
return(color.length==7?color:(arguments[0]||this));};Element.collectTextNodes=function(element){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:(node.hasChildNodes()?Element.collectTextNodes(node):''));}).flatten().join('');};Element.collectTextNodesIgnoreClass=function(element,className){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:((node.hasChildNodes()&&!Element.hasClassName(node,className))?Element.collectTextNodesIgnoreClass(node,className):''));}).flatten().join('');};Element.setContentZoom=function(element,percent){element=$(element);element.setStyle({fontSize:(percent/100)+'em'});if(Prototype.Browser.WebKit)window.scrollBy(0,0);return element;};Element.getInlineOpacity=function(element){return $(element).style.opacity||'';};Element.forceRerendering=function(element){try{element=$(element);var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}};var Effect={_elementDoesNotExistError:{name:'ElementDoesNotExistError',message:'The specified DOM element does not exist, but is required for this effect to operate'},Transitions:{linear:Prototype.K,sinoidal:function(pos){return(-Math.cos(pos*Math.PI)/2)+.5;},reverse:function(pos){return 1-pos;},flicker:function(pos){var pos=((-Math.cos(pos*Math.PI)/4)+.75)+Math.random()/4;return pos>1?1:pos;},wobble:function(pos){return(-Math.cos(pos*Math.PI*(9*pos))/2)+.5;},pulse:function(pos,pulses){return(-Math.cos((pos*((pulses||5)-.5)*2)*Math.PI)/2)+.5;},spring:function(pos){return 1-(Math.cos(pos*4.5*Math.PI)*Math.exp(-pos*6));},none:function(pos){return 0;},full:function(pos){return 1;}},DefaultOptions:{duration:1.0,fps:100,sync:false,from:0.0,to:1.0,delay:0.0,queue:'parallel'},tagifyText:function(element){var tagifyStyle='position:relative';if(Prototype.Browser.IE)tagifyStyle+=';zoom:1';element=$(element);$A(element.childNodes).each(function(child){if(child.nodeType==3){child.nodeValue.toArray().each(function(character){element.insertBefore(new Element('span',{style:tagifyStyle}).update(character==' '?String.fromCharCode(160):character),child);});Element.remove(child);}});},multiple:function(element,effect){var elements;if(((typeof element=='object')||Object.isFunction(element))&&(element.length))
elements=element;else
elements=$(element).childNodes;var options=Object.extend({speed:0.1,delay:0.0},arguments[2]||{});var masterDelay=options.delay;$A(elements).each(function(element,index){new effect(element,Object.extend(options,{delay:index*options.speed+masterDelay}));});},PAIRS:{'slide':['SlideDown','SlideUp'],'blind':['BlindDown','BlindUp'],'appear':['Appear','Fade']},toggle:function(element,effect,options){element=$(element);effect=(effect||'appear').toLowerCase();return Effect[Effect.PAIRS[effect][element.visible()?1:0]](element,Object.extend({queue:{position:'end',scope:(element.id||'global'),limit:1}},options||{}));}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(iterator){this.effects._each(iterator);},add:function(effect){var timestamp=new Date().getTime();var position=Object.isString(effect.options.queue)?effect.options.queue:effect.options.queue.position;switch(position){case'front':this.effects.findAll(function(e){return e.state=='idle'}).each(function(e){e.startOn+=effect.finishOn;e.finishOn+=effect.finishOn;});break;case'with-last':timestamp=this.effects.pluck('startOn').max()||timestamp;break;case'end':timestamp=this.effects.pluck('finishOn').max()||timestamp;break;}
effect.startOn+=timestamp;effect.finishOn+=timestamp;if(!effect.options.queue.limit||(this.effects.length<effect.options.queue.limit))
this.effects.push(effect);if(!this.interval)
this.interval=setInterval(this.loop.bind(this),15);},remove:function(effect){this.effects=this.effects.reject(function(e){return e==effect});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var timePos=new Date().getTime();for(var i=0,len=this.effects.length;i<len;i++)
this.effects[i]&&this.effects[i].loop(timePos);}});Effect.Queues={instances:$H(),get:function(queueName){if(!Object.isString(queueName))return queueName;return this.instances.get(queueName)||this.instances.set(queueName,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get('global');Effect.Base=Class.create({position:null,start:function(options){if(options&&options.transition===false)options.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state='idle';this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function dispatch(effect,eventName){if(effect.options[eventName+'Internal'])
effect.options[eventName+'Internal'](effect);if(effect.options[eventName])
effect.options[eventName](effect);}
return function(pos){if(this.state==="idle"){this.state="running";dispatch(this,'beforeSetup');if(this.setup)this.setup();dispatch(this,'afterSetup');}
if(this.state==="running"){pos=(this.options.transition(pos)*this.fromToDelta)+this.options.from;this.position=pos;dispatch(this,'beforeUpdate');if(this.update)this.update(pos);dispatch(this,'afterUpdate');}};})();this.event('beforeStart');if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).add(this);},loop:function(timePos){if(timePos>=this.startOn){if(timePos>=this.finishOn){this.render(1.0);this.cancel();this.event('beforeFinish');if(this.finish)this.finish();this.event('afterFinish');return;}
var pos=(timePos-this.startOn)/this.totalTime,frame=(pos*this.totalFrames).round();if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame;}}},cancel:function(){if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).remove(this);this.state='finished';},event:function(eventName){if(this.options[eventName+'Internal'])this.options[eventName+'Internal'](this);if(this.options[eventName])this.options[eventName](this);},inspect:function(){var data=$H();for(property in this)
if(!Object.isFunction(this[property]))data.set(property,this[property]);return'#<Effect:'+data.inspect()+',options:'+$H(this.options).inspect()+'>';}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(effects){this.effects=effects||[];this.start(arguments[1]);},update:function(position){this.effects.invoke('render',position);},finish:function(position){this.effects.each(function(effect){effect.render(1.0);effect.cancel();effect.event('beforeFinish');if(effect.finish)effect.finish(position);effect.event('afterFinish');});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(object,from,to){object=Object.isString(object)?$(object):object;var args=$A(arguments),method=args.last(),options=args.length==5?args[3]:null;this.method=Object.isFunction(method)?method.bind(object):Object.isFunction(object[method])?object[method].bind(object):function(value){object[method]=value};this.start(Object.extend({from:from,to:to},options||{}));},update:function(position){this.method(position);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});var options=Object.extend({from:this.element.getOpacity()||0.0,to:1.0},arguments[1]||{});this.start(options);},update:function(position){this.element.setOpacity(position);}});Effect.Move=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({x:0,y:0,mode:'relative'},arguments[1]||{});this.start(options);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle('left')||'0');this.originalTop=parseFloat(this.element.getStyle('top')||'0');if(this.options.mode=='absolute'){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(position){this.element.setStyle({left:(this.options.x*position+this.originalLeft).round()+'px',top:(this.options.y*position+this.originalTop).round()+'px'});}});Effect.MoveBy=function(element,toTop,toLeft){return new Effect.Move(element,Object.extend({x:toLeft,y:toTop},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(element,percent){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:'box',scaleFrom:100.0,scaleTo:percent},arguments[2]||{});this.start(options);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle('position');this.originalStyle={};['top','left','width','height','fontSize'].each(function(k){this.originalStyle[k]=this.element.style[k];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var fontSize=this.element.getStyle('font-size')||'100%';['em','px','%','pt'].each(function(fontSizeType){if(fontSize.indexOf(fontSizeType)>0){this.fontSize=parseFloat(fontSize);this.fontSizeType=fontSizeType;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=='box')
this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))
this.dims=[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)
this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];},update:function(position){var currentScale=(this.options.scaleFrom/100.0)+(this.factor*position);if(this.options.scaleContent&&this.fontSize)
this.element.setStyle({fontSize:this.fontSize*currentScale+this.fontSizeType});this.setDimensions(this.dims[0]*currentScale,this.dims[1]*currentScale);},finish:function(position){if(this.restoreAfterFinish)this.element.setStyle(this.originalStyle);},setDimensions:function(height,width){var d={};if(this.options.scaleX)d.width=width.round()+'px';if(this.options.scaleY)d.height=height.round()+'px';if(this.options.scaleFromCenter){var topd=(height-this.dims[0])/2;var leftd=(width-this.dims[1])/2;if(this.elementPositioning=='absolute'){if(this.options.scaleY)d.top=this.originalTop-topd+'px';if(this.options.scaleX)d.left=this.originalLeft-leftd+'px';}else{if(this.options.scaleY)d.top=-topd+'px';if(this.options.scaleX)d.left=-leftd+'px';}}
this.element.setStyle(d);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({startcolor:'#ffff99'},arguments[1]||{});this.start(options);},setup:function(){if(this.element.getStyle('display')=='none'){this.cancel();return;}
this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle('background-image');this.element.setStyle({backgroundImage:'none'});}
if(!this.options.endcolor)
this.options.endcolor=this.element.getStyle('background-color').parseColor('#ffffff');if(!this.options.restorecolor)
this.options.restorecolor=this.element.getStyle('background-color');this._base=$R(0,2).map(function(i){return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(i){return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i]}.bind(this));},update:function(position){this.element.setStyle({backgroundColor:$R(0,2).inject('#',function(m,v,i){return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}));}});Effect.ScrollTo=function(element){var options=arguments[1]||{},scrollOffsets=document.viewport.getScrollOffsets(),elementOffsets=$(element).cumulativeOffset();if(options.offset)elementOffsets[1]+=options.offset;return new Effect.Tween(null,scrollOffsets.top,elementOffsets[1],options,function(p){scrollTo(scrollOffsets.left,p.round());});};Effect.Fade=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();var options=Object.extend({from:element.getOpacity()||1.0,to:0.0,afterFinishInternal:function(effect){if(effect.options.to!=0)return;effect.element.hide().setStyle({opacity:oldOpacity});}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Appear=function(element){element=$(element);var options=Object.extend({from:(element.getStyle('display')=='none'?0.0:element.getOpacity()||0.0),to:1.0,afterFinishInternal:function(effect){effect.element.forceRerendering();},beforeSetup:function(effect){effect.element.setOpacity(effect.options.from).show();}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Puff=function(element){element=$(element);var oldStyle={opacity:element.getInlineOpacity(),position:element.getStyle('position'),top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:1.0,beforeSetupInternal:function(effect){Position.absolutize(effect.effects[0].element);},afterFinishInternal:function(effect){effect.effects[0].element.hide().setStyle(oldStyle);}},arguments[1]||{}));};Effect.BlindUp=function(element){element=$(element);element.makeClipping();return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(effect){effect.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(element){element=$(element);var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makeClipping().setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();return new Effect.Appear(element,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(effect){new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned().setStyle({opacity:oldOpacity});}});}},arguments[1]||{}));};Effect.DropOut=function(element){element=$(element);var oldStyle={top:element.getStyle('top'),left:element.getStyle('left'),opacity:element.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(element,{x:0,y:100,sync:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:0.5,beforeSetup:function(effect){effect.effects[0].element.makePositioned();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);}},arguments[1]||{}));};Effect.Shake=function(element){element=$(element);var options=Object.extend({distance:20,duration:0.5},arguments[1]||{});var distance=parseFloat(options.distance);var split=parseFloat(options.duration)/10.0;var oldStyle={top:element.getStyle('top'),left:element.getStyle('left')};return new Effect.Move(element,{x:distance,y:0,duration:split,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance,y:0,duration:split,afterFinishInternal:function(effect){effect.element.undoPositioned().setStyle(oldStyle);}});}});}});}});}});}});};Effect.SlideDown=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().setStyle({height:'0px'}).show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.SlideUp=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:'box',scaleFrom:100,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.Squish=function(element){return new Effect.Scale(element,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping();}});};Effect.Grow=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case'top-left':initialMoveX=initialMoveY=moveX=moveY=0;break;case'top-right':initialMoveX=dims.width;initialMoveY=moveY=0;moveX=-dims.width;break;case'bottom-left':initialMoveX=moveX=0;initialMoveY=dims.height;moveY=-dims.height;break;case'bottom-right':initialMoveX=dims.width;initialMoveY=dims.height;moveX=-dims.width;moveY=-dims.height;break;case'center':initialMoveX=dims.width/2;initialMoveY=dims.height/2;moveX=-dims.width/2;moveY=-dims.height/2;break;}
return new Effect.Move(element,{x:initialMoveX,y:initialMoveY,duration:0.01,beforeSetup:function(effect){effect.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(effect){new Effect.Parallel([new Effect.Opacity(effect.element,{sync:true,to:1.0,from:0.0,transition:options.opacityTransition}),new Effect.Move(effect.element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition}),new Effect.Scale(effect.element,100,{scaleMode:{originalHeight:dims.height,originalWidth:dims.width},sync:true,scaleFrom:window.opera?1:0,transition:options.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(effect){effect.effects[0].element.setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);}},options));}});};Effect.Shrink=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var moveX,moveY;switch(options.direction){case'top-left':moveX=moveY=0;break;case'top-right':moveX=dims.width;moveY=0;break;case'bottom-left':moveX=0;moveY=dims.height;break;case'bottom-right':moveX=dims.width;moveY=dims.height;break;case'center':moveX=dims.width/2;moveY=dims.height/2;break;}
return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0.0,from:1.0,transition:options.opacityTransition}),new Effect.Scale(element,window.opera?1:0,{sync:true,transition:options.scaleTransition,restoreAfterFinish:true}),new Effect.Move(element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition})],Object.extend({beforeStartInternal:function(effect){effect.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle);}},options));};Effect.Pulsate=function(element){element=$(element);var options=arguments[1]||{},oldOpacity=element.getInlineOpacity(),transition=options.transition||Effect.Transitions.linear,reverser=function(pos){return 1-transition((-Math.cos((pos*(options.pulses||5)*2)*Math.PI)/2)+.5);};return new Effect.Opacity(element,Object.extend(Object.extend({duration:2.0,from:0,afterFinishInternal:function(effect){effect.element.setStyle({opacity:oldOpacity});}},options),{transition:reverser}));};Effect.Fold=function(element){element=$(element);var oldStyle={top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};element.makeClipping();return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(effect){effect.element.hide().undoClipping().setStyle(oldStyle);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(options.style))this.style=$H(options.style);else{if(options.style.include(':'))
this.style=options.style.parseStyle();else{this.element.addClassName(options.style);this.style=$H(this.element.getStyles());this.element.removeClassName(options.style);var css=this.element.getStyles();this.style=this.style.reject(function(style){return style.value==css[style.key];});options.afterFinishInternal=function(effect){effect.element.addClassName(effect.options.style);effect.transforms.each(function(transform){effect.element.style[transform.style]='';});};}}
this.start(options);},setup:function(){function parseColor(color){if(!color||['rgba(0, 0, 0, 0)','transparent'].include(color))color='#ffffff';color=color.parseColor();return $R(0,2).map(function(i){return parseInt(color.slice(i*2+1,i*2+3),16);});}
this.transforms=this.style.map(function(pair){var property=pair[0],value=pair[1],unit=null;if(value.parseColor('#zzzzzz')!='#zzzzzz'){value=value.parseColor();unit='color';}else if(property=='opacity'){value=parseFloat(value);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});}else if(Element.CSS_LENGTH.test(value)){var components=value.match(/^([\+\-]?[0-9\.]+)(.*)$/);value=parseFloat(components[1]);unit=(components.length==3)?components[2]:null;}
var originalValue=this.element.getStyle(property);return{style:property.camelize(),originalValue:unit=='color'?parseColor(originalValue):parseFloat(originalValue||0),targetValue:unit=='color'?parseColor(value):value,unit:unit};}.bind(this)).reject(function(transform){return((transform.originalValue==transform.targetValue)||(transform.unit!='color'&&(isNaN(transform.originalValue)||isNaN(transform.targetValue))));});},update:function(position){var style={},transform,i=this.transforms.length;while(i--)
style[(transform=this.transforms[i]).style]=transform.unit=='color'?'#'+
(Math.round(transform.originalValue[0]+
(transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart()+
(Math.round(transform.originalValue[1]+
(transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart()+
(Math.round(transform.originalValue[2]+
(transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart():(transform.originalValue+
(transform.targetValue-transform.originalValue)*position).toFixed(3)+
(transform.unit===null?'':transform.unit);this.element.setStyle(style,true);}});Effect.Transform=Class.create({initialize:function(tracks){this.tracks=[];this.options=arguments[1]||{};this.addTracks(tracks);},addTracks:function(tracks){tracks.each(function(track){track=$H(track);var data=track.values().first();this.tracks.push($H({ids:track.keys().first(),effect:Effect.Morph,options:{style:data}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(track){var ids=track.get('ids'),effect=track.get('effect'),options=track.get('options');var elements=[$(ids)||$$(ids)].flatten();return elements.map(function(e){return new effect(e,Object.extend({sync:true},options))});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w('backgroundColor backgroundPosition borderBottomColor borderBottomStyle '+'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth '+'borderRightColor borderRightStyle borderRightWidth borderSpacing '+'borderTopColor borderTopStyle borderTopWidth bottom clip color '+'fontSize fontWeight height left letterSpacing lineHeight '+'marginBottom marginLeft marginRight marginTop markerOffset maxHeight '+'maxWidth minHeight minWidth opacity outlineColor outlineOffset '+'outlineWidth paddingBottom paddingLeft paddingRight paddingTop '+'right textIndent top width wordSpacing zIndex');Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement('div');String.prototype.parseStyle=function(){var style,styleRules=$H();if(Prototype.Browser.WebKit)
style=new Element('div',{style:this}).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';style=String.__parseStyleElement.childNodes[0].style;}
Element.CSS_PROPERTIES.each(function(property){if(style[property])styleRules.set(property,style[property]);});if(Prototype.Browser.IE&&this.include('opacity'))
styleRules.set('opacity',this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return styleRules;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(element){var css=document.defaultView.getComputedStyle($(element),null);return Element.CSS_PROPERTIES.inject({},function(styles,property){styles[property]=css[property];return styles;});};}else{Element.getStyles=function(element){element=$(element);var css=element.currentStyle,styles;styles=Element.CSS_PROPERTIES.inject({},function(results,property){results[property]=css[property];return results;});if(!styles.opacity)styles.opacity=element.getOpacity();return styles;};}
Effect.Methods={morph:function(element,style){element=$(element);new Effect.Morph(element,Object.extend({style:style},arguments[2]||{}));return element;},visualEffect:function(element,effect,options){element=$(element);var s=effect.dasherize().camelize(),klass=s.charAt(0).toUpperCase()+s.substring(1);new Effect[klass](element,options);return element;},highlight:function(element,options){element=$(element);new Effect.Highlight(element,options);return element;}};$w('fade appear grow shrink fold blindUp blindDown slideUp slideDown '+'pulsate shake puff squish switchOff dropOut').each(function(effect){Effect.Methods[effect]=function(element,options){element=$(element);Effect[effect.charAt(0).toUpperCase()+effect.substring(1)](element,options);return element;};});$w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each(function(f){Effect.Methods[f]=Element[f];});Element.addMethods(Effect.Methods);if(typeof Effect=='undefined')
throw("controls.js requires including script.aculo.us' effects.js library");var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(element,update,options){element=$(element);this.element=element;this.update=$(update);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions)
this.setOptions(options);else
this.options=options||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(element,update){if(!update.style.position||update.style.position=='absolute'){update.style.position='absolute';Position.clone(element,update,{setHeight:false,offsetTop:element.offsetHeight});}
Effect.Appear(update,{duration:0.15});};this.options.onHide=this.options.onHide||function(element,update){new Effect.Fade(update,{duration:0.15})};if(typeof(this.options.tokens)=='string')
this.options.tokens=new Array(this.options.tokens);if(!this.options.tokens.include('\n'))
this.options.tokens.push('\n');this.observer=null;this.element.setAttribute('autocomplete','off');Element.hide(this.update);Event.observe(this.element,'blur',this.onBlur.bindAsEventListener(this));Event.observe(this.element,'focus',function(){this.active=true;this.show()}.bind(this));Event.observe(this.element,'keydown',this.onKeyPress.bindAsEventListener(this));if(document.getBoxObjectFor)
Event.observe(this.element,"input",this.onKeyPress.bindAsEventListener(this));},show:function(){if(Element.getStyle(this.update,'display')=='none')this.options.onShow(this.element,this.update);if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,'position')=='absolute')){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" '+'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+'_iefix');}
if(this.iefix)setTimeout(this.fixIEOverlapping.bind(this),50);},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix);},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,'display')!='none')this.options.onHide(this.element,this.update);if(this.iefix)Element.hide(this.iefix);},startIndicator:function(){if(this.options.indicator)Element.show(this.options.indicator);},stopIndicator:function(){if(this.options.indicator)Element.hide(this.options.indicator);},onKeyPress:function(event){if(this.active)
switch(event.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(event);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(event);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(event);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(event);return;}
else
if(event.keyCode==Event.KEY_TAB||event.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&event.keyCode==0))return;if(event.type=='keydown'&&document.getBoxObjectFor)return;this.changed=true;this.hasFocus=true;if(this.observer)clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices();},onHover:function(event){var element=Event.findElement(event,'LI');if(this.index!=element.autocompleteIndex)
{this.index=element.autocompleteIndex;this.render();}
Event.stop(event);},onClick:function(event){var element=Event.findElement(event,'LI');this.index=element.autocompleteIndex;this.selectEntry();this.hide();},onBlur:function(event){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false;},render:function(){if(this.entryCount>0){for(var i=0;i<this.entryCount;i++)
this.index==i?Element.addClassName(this.getEntry(i),"selected"):Element.removeClassName(this.getEntry(i),"selected");if(this.hasFocus){this.show();this.active=true;}}else{this.active=false;this.hide();}},markPrevious:function(){if(this.index>0){this.index--;}
else{this.index=this.entryCount-1;this.update.scrollTop=this.update.scrollHeight;}
selection=this.getEntry(this.index);selection_top=selection.offsetTop;if(selection_top<this.update.scrollTop){this.update.scrollTop=this.update.scrollTop-selection.offsetHeight;}},markNext:function(){if(this.index<this.entryCount-1){this.index++;}
else{this.index=0;this.update.scrollTop=0;}
selection=this.getEntry(this.index);selection_bottom=selection.offsetTop+selection.offsetHeight;if(selection_bottom>this.update.scrollTop+this.update.offsetHeight){this.update.scrollTop=this.update.scrollTop+selection.offsetHeight;}},getEntry:function(index){return this.update.firstChild.childNodes[index];},getCurrentEntry:function(){return this.getEntry(this.index);},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry());},updateElement:function(selectedElement){if(this.options.updateElement){this.options.updateElement(selectedElement);return;}
var value='';if(this.options.select){var nodes=$(selectedElement).select('.'+this.options.select)||[];if(nodes.length>0)value=Element.collectTextNodes(nodes[0],this.options.select);}else
value=Element.collectTextNodesIgnoreClass(selectedElement,'informal');var bounds=this.getTokenBounds();if(bounds[0]!=-1){var newValue=this.element.value.substr(0,bounds[0]);var whitespace=this.element.value.substr(bounds[0]).match(/^\s+/);if(whitespace)
newValue+=whitespace[0];this.element.value=newValue+value+this.element.value.substr(bounds[1]);}else{this.element.value=value;}
this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement)
this.options.afterUpdateElement(this.element,selectedElement);},updateChoices:function(choices){if(!this.changed&&this.hasFocus){this.update.innerHTML=choices;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var i=0;i<this.entryCount;i++){var entry=this.getEntry(i);entry.autocompleteIndex=i;this.addObservers(entry);}}else{this.entryCount=0;}
this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide();}else{this.render();}}},addObservers:function(element){Event.observe(element,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(element,"click",this.onClick.bindAsEventListener(this));},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices();}else{this.active=false;this.hide();}
this.oldElementValue=this.element.value;},getToken:function(){var bounds=this.getTokenBounds();return this.element.value.substring(bounds[0],bounds[1]).strip();},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var value=this.element.value;if(value.strip().empty())return[-1,0];var diff=arguments.callee.getFirstDifferencePos(value,this.oldElementValue);var offset=(diff==this.oldElementValue.length?1:0);var prevTokenPos=-1,nextTokenPos=value.length;var tp;for(var index=0,l=this.options.tokens.length;index<l;++index){tp=value.lastIndexOf(this.options.tokens[index],diff+offset-1);if(tp>prevTokenPos)prevTokenPos=tp;tp=value.indexOf(this.options.tokens[index],diff+offset);if(-1!=tp&&tp<nextTokenPos)nextTokenPos=tp;}
return(this.tokenBounds=[prevTokenPos+1,nextTokenPos]);}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(newS,oldS){var boundary=Math.min(newS.length,oldS.length);for(var index=0;index<boundary;++index)
if(newS[index]!=oldS[index])
return index;return boundary;};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(element,update,url,options){this.baseInitialize(element,update,options);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=url;},getUpdatedChoices:function(){this.startIndicator();var entry=encodeURIComponent(this.options.paramName)+'='+
encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams)
this.options.parameters+='&'+this.options.defaultParams;new Ajax.Request(this.url,this.options);},onComplete:function(request){this.updateChoices(request.responseText);}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(element,update,array,options){this.baseInitialize(element,update,options);this.options.array=array;},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this));},setOptions:function(options){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(instance){var ret=[];var partial=[];var entry=instance.getToken();var count=0;for(var i=0;i<instance.options.array.length&&ret.length<instance.options.choices;i++){var elem=instance.options.array[i];var foundPos=instance.options.ignoreCase?elem.toLowerCase().indexOf(entry.toLowerCase()):elem.indexOf(entry);while(foundPos!=-1){if(foundPos==0&&elem.length!=entry.length){ret.push("<li><strong>"+elem.substr(0,entry.length)+"</strong>"+
elem.substr(entry.length)+"</li>");break;}else if(entry.length>=instance.options.partialChars&&instance.options.partialSearch&&foundPos!=-1){if(instance.options.fullSearch||/\s/.test(elem.substr(foundPos-1,1))){partial.push("<li>"+elem.substr(0,foundPos)+"<strong>"+
elem.substr(foundPos,entry.length)+"</strong>"+elem.substr(foundPos+entry.length)+"</li>");break;}}
foundPos=instance.options.ignoreCase?elem.toLowerCase().indexOf(entry.toLowerCase(),foundPos+1):elem.indexOf(entry,foundPos+1);}}
if(partial.length)
ret=ret.concat(partial.slice(0,instance.options.choices-ret.length));return"<ul>"+ret.join('')+"</ul>";}},options||{});}});Field.scrollFreeActivate=function(field){setTimeout(function(){Field.activate(field);},1);};Ajax.InPlaceEditor=Class.create({initialize:function(element,url,options){this.url=url;this.element=element=$(element);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(options);Object.extend(this.options,options||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+'-inplaceeditor';if($(this.options.formId))
this.options.formId='';}
if(this.options.externalControl)
this.options.externalControl=$(this.options.externalControl);if(!this.options.externalControl)
this.options.externalControlOnly=false;this._originalBackground=this.element.getStyle('background-color')||'transparent';this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners();},checkForEscapeOrReturn:function(e){if(!this._editing||e.ctrlKey||e.altKey||e.shiftKey)return;if(Event.KEY_ESC==e.keyCode)
this.handleFormCancellation(e);else if(Event.KEY_RETURN==e.keyCode)
this.handleFormSubmission(e);},createControl:function(mode,handler,extraClasses){var control=this.options[mode+'Control'];var text=this.options[mode+'Text'];if('button'==control){var btn=document.createElement('input');btn.type='submit';btn.value=text;btn.className='editor_'+mode+'_button';if('cancel'==mode)
btn.onclick=this._boundCancelHandler;this._form.appendChild(btn);this._controls[mode]=btn;}else if('link'==control){var link=document.createElement('a');link.href='#';link.appendChild(document.createTextNode(text));link.onclick='cancel'==mode?this._boundCancelHandler:this._boundSubmitHandler;link.className='editor_'+mode+'_link';if(extraClasses)
link.className+=' '+extraClasses;this._form.appendChild(link);this._controls[mode]=link;}},createEditField:function(){var text=(this.options.loadTextURL?this.options.loadingText:this.getText());var fld;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){fld=document.createElement('input');fld.type='text';var size=this.options.size||this.options.cols||0;if(0<size)fld.size=size;}else{fld=document.createElement('textarea');fld.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);fld.cols=this.options.cols||40;}
fld.name=this.options.paramName;fld.value=text;fld.className='editor_field';if(this.options.submitOnBlur)
fld.onblur=this._boundSubmitHandler;this._controls.editor=fld;if(this.options.loadTextURL)
this.loadExternalText();this._form.appendChild(this._controls.editor);},createForm:function(){var ipe=this;function addText(mode,condition){var text=ipe.options['text'+mode+'Controls'];if(!text||condition===false)return;ipe._form.appendChild(document.createTextNode(text));};this._form=$(document.createElement('form'));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if('textarea'==this._controls.editor.tagName.toLowerCase())
this._form.appendChild(document.createElement('br'));if(this.options.onFormCustomization)
this.options.onFormCustomization(this,this._form);addText('Before',this.options.okControl||this.options.cancelControl);this.createControl('ok',this._boundSubmitHandler);addText('Between',this.options.okControl&&this.options.cancelControl);this.createControl('cancel',this._boundCancelHandler,'editor_cancel');addText('After',this.options.okControl||this.options.cancelControl);},destroy:function(){if(this._oldInnerHTML)
this.element.innerHTML=this._oldInnerHTML;this.leaveEditMode();this.unregisterListeners();},enterEditMode:function(e){if(this._saving||this._editing)return;this._editing=true;this.triggerCallback('onEnterEditMode');if(this.options.externalControl)
this.options.externalControl.hide();this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL)
this.postProcessEditField();if(e)Event.stop(e);},enterHover:function(e){if(this.options.hoverClassName)
this.element.addClassName(this.options.hoverClassName);if(this._saving)return;this.triggerCallback('onEnterHover');},getText:function(){return this.element.innerHTML.unescapeHTML();},handleAJAXFailure:function(transport){this.triggerCallback('onFailure',transport);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null;}},handleFormCancellation:function(e){this.wrapUp();if(e)Event.stop(e);},handleFormSubmission:function(e){var form=this._form;var value=$F(this._controls.editor);this.prepareSubmission();var params=this.options.callback(form,value)||'';if(Object.isString(params))
params=params.toQueryParams();params.editorId=this.element.id;if(this.options.htmlResponse){var options=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(options,{parameters:params,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,options);}else{var options=Object.extend({method:'get'},this.options.ajaxOptions);Object.extend(options,{parameters:params,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,options);}
if(e)Event.stop(e);},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl)
this.options.externalControl.show();this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback('onLeaveEditMode');},leaveHover:function(e){if(this.options.hoverClassName)
this.element.removeClassName(this.options.hoverClassName);if(this._saving)return;this.triggerCallback('onLeaveHover');},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var options=Object.extend({method:'get'},this.options.ajaxOptions);Object.extend(options,{parameters:'editorId='+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){this._form.removeClassName(this.options.loadingClassName);var text=transport.responseText;if(this.options.stripLoadedTextTags)
text=text.stripTags();this._controls.editor.value=text;this._controls.editor.disabled=false;this.postProcessEditField();}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,options);},postProcessEditField:function(){var fpc=this.options.fieldPostCreation;if(fpc)
$(this._controls.editor)['focus'==fpc?'focus':'activate']();},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(defs){Object.extend(this.options,defs);}.bind(this));},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving();},registerListeners:function(){this._listeners={};var listener;$H(Ajax.InPlaceEditor.Listeners).each(function(pair){listener=this[pair.value].bind(this);this._listeners[pair.key]=listener;if(!this.options.externalControlOnly)
this.element.observe(pair.key,listener);if(this.options.externalControl)
this.options.externalControl.observe(pair.key,listener);}.bind(this));},removeForm:function(){if(!this._form)return;this._form.remove();this._form=null;this._controls={};},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show();},triggerCallback:function(cbName,arg){if('function'==typeof this.options[cbName]){this.options[cbName](this,arg);}},unregisterListeners:function(){$H(this._listeners).each(function(pair){if(!this.options.externalControlOnly)
this.element.stopObserving(pair.key,pair.value);if(this.options.externalControl)
this.options.externalControl.stopObserving(pair.key,pair.value);}.bind(this));},wrapUp:function(transport){this.leaveEditMode();this._boundComplete(transport,this.element);}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,element,url,options){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(element,url,options);},createEditField:function(){var list=document.createElement('select');list.name=this.options.paramName;list.size=1;this._controls.editor=list;this._collection=this.options.collection||[];if(this.options.loadCollectionURL)
this.loadCollection();else
this.checkForExternalText();this._form.appendChild(this._controls.editor);},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:'get'},this.options.ajaxOptions);Object.extend(options,{parameters:'editorId='+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js))
throw('Server returned an invalid collection representation.');this._collection=eval(js);this.checkForExternalText();}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options);},showLoadingText:function(text){this._controls.editor.disabled=true;var tempOption=this._controls.editor.firstChild;if(!tempOption){tempOption=document.createElement('option');tempOption.value='';this._controls.editor.appendChild(tempOption);tempOption.selected=true;}
tempOption.update((text||'').stripScripts().stripTags());},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL)
this.loadExternalText();else
this.buildOptionList();},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var options=Object.extend({method:'get'},this.options.ajaxOptions);Object.extend(options,{parameters:'editorId='+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){this._text=transport.responseText.strip();this.buildOptionList();}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,options);},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(entry){return 2===entry.length?entry:[entry,entry].flatten();});var marker=('value'in this.options)?this.options.value:this._text;var textFound=this._collection.any(function(entry){return entry[0]==marker;}.bind(this));this._controls.editor.update('');var option;this._collection.each(function(entry,index){option=document.createElement('option');option.value=entry[0];option.selected=textFound?entry[0]==marker:0==index;option.appendChild(document.createTextNode(entry[1]));this._controls.editor.appendChild(option);}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor);}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(options){if(!options)return;function fallback(name,expr){if(name in options||expr===undefined)return;options[name]=expr;};fallback('cancelControl',(options.cancelLink?'link':(options.cancelButton?'button':options.cancelLink==options.cancelButton==false?false:undefined)));fallback('okControl',(options.okLink?'link':(options.okButton?'button':options.okLink==options.okButton==false?false:undefined)));fallback('highlightColor',options.highlightcolor);fallback('highlightEndColor',options.highlightendcolor);};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:'link',cancelText:'cancel',clickToEditText:'Click to edit',externalControl:null,externalControlOnly:false,fieldPostCreation:'activate',formClassName:'inplaceeditor-form',formId:null,highlightColor:'#ffff99',highlightEndColor:'#ffffff',hoverClassName:'',htmlResponse:true,loadingClassName:'inplaceeditor-loading',loadingText:'Loading...',okControl:'button',okText:'ok',paramName:'value',rows:1,savingClassName:'inplaceeditor-saving',savingText:'Saving...',size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:'',textBeforeControls:'',textBetweenControls:''},DefaultCallbacks:{callback:function(form){return Form.serialize(form);},onComplete:function(transport,element){new Effect.Highlight(element,{startcolor:this.options.highlightColor,keepBackgroundImage:true});},onEnterEditMode:null,onEnterHover:function(ipe){ipe.element.style.backgroundColor=ipe.options.highlightColor;if(ipe._effect)
ipe._effect.cancel();},onFailure:function(transport,ipe){alert('Error communication with the server: '+transport.responseText.stripTags());},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(ipe){ipe._effect=new Effect.Highlight(ipe.element,{startcolor:ipe.options.highlightColor,endcolor:ipe.options.highlightEndColor,restorecolor:ipe._originalBackground,keepBackgroundImage:true});}},Listeners:{click:'enterEditMode',keydown:'checkForEscapeOrReturn',mouseover:'enterHover',mouseout:'leaveHover'}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:'Loading options...'};Form.Element.DelayedObserver=Class.create({initialize:function(element,delay,callback){this.delay=delay||0.5;this.element=$(element);this.callback=callback;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,'keyup',this.delayedListener.bindAsEventListener(this));},delayedListener:function(event){if(this.lastValue==$F(this.element))return;if(this.timer)clearTimeout(this.timer);this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element);},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element));}});Ajax.InPlaceEditor.prototype.__initialize=Ajax.InPlaceEditor.prototype.initialize;Ajax.InPlaceEditor.prototype.__getText=Ajax.InPlaceEditor.prototype.getText;Ajax.InPlaceEditor.prototype.__onComplete=Ajax.InPlaceEditor.prototype.leaveEditMode;Ajax.InPlaceEditor.prototype.__handleFormSubmission=Ajax.InPlaceEditor.prototype.handleFormSubmission;Ajax.InPlaceEditor.prototype=Object.extend(Ajax.InPlaceEditor.prototype,{initialize:function(element,url,options){this.setOptions(options);this.__initialize(element,url,options)
this._checkEmpty();},setOptions:function(options){if(!options.emptyText)options.emptyText=" ";if(!options.emptyClassName)options.emptyClassName="inplaceeditor-empty";},_checkEmpty:function(){if(this.element.innerHTML.length==0){this.element.appendChild(Builder.node('span',{className:this.options.emptyClassName},this.options.emptyText));}},getText:function(){empty_span=this.element.select("."+this.options.emptyClassName).first()
if(empty_span){empty_span.remove();}
return this.__getText();},leaveEditMode:function(transport){this._checkEmpty();this.__onComplete(transport);},handleFormSubmission:function(e){var value=$F(this._controls.editor);if(value==this.element.innerHTML){this.leaveEditMode();if(e)Event.stop(e);}
else
this.__handleFormSubmission(e);}});Object.alias=function(pro,to,from){pro[to]=pro[from];return pro;}
Ajax.InPlaceEditor.LocalCompletion=Class.create();Object.extend(Ajax.InPlaceEditor.LocalCompletion.prototype,Ajax.InPlaceEditor.prototype);Object.alias(Ajax.InPlaceEditor.LocalCompletion.prototype,'super_initialize','initialize');Object.alias(Ajax.InPlaceEditor.LocalCompletion.prototype,'super_createEditField','createEditField');Object.alias(Ajax.InPlaceEditor.LocalCompletion.prototype,'super_leaveEditMode','leaveEditMode');Object.extend(Ajax.InPlaceEditor.LocalCompletion.prototype,{initialize:function(element,completion_element,completion_array,url,options,completion_options){this.super_initialize(element,url,options);this.completion_element=completion_element;this.completion_array=completion_array;this.completion_options=completion_options;},createEditField:function(){var ret=this.super_createEditField();this.completer=new Autocompleter.Local(this.editField,this.completion_element,this.completion_array,this.completion_options);return ret;},leaveEditMode:function(){this.completer=null;this.super_leaveEditMode();}});Ajax.InPlaceEditor.Completion=Class.create();Object.extend(Ajax.InPlaceEditor.Completion.prototype,Ajax.InPlaceEditor.prototype);Object.alias(Ajax.InPlaceEditor.Completion.prototype,'super_initialize','initialize');Object.alias(Ajax.InPlaceEditor.Completion.prototype,'super_createEditField','createEditField');Object.alias(Ajax.InPlaceEditor.Completion.prototype,'super_leaveEditMode','leaveEditMode');Object.extend(Ajax.InPlaceEditor.Completion.prototype,{initialize:function(element,completion_element,completion_url,url,options,completion_options){this.super_initialize(element,url,options);this.completion_element=completion_element;this.completion_url=completion_url;this.completion_options=completion_options;},createEditField:function(){var ret=this.super_createEditField();this.completer=new Ajax.Autocompleter(this.editField,this.completion_element,this.completion_url,this.completion_options);return ret;},leaveEditMode:function(){this.completer=null;this.super_leaveEditMode();}});var Lightbox;Event.observe(window,'load',initialize,false);var lightbox=Class.create();lightbox.prototype={yPos:0,xPos:0,initialize:function(){this.addLightboxMarkup();},center_position:function(){$('lightbox').style.margin="";$('lightbox').style.height="";$('lightbox').style.width="";$('lightbox').style.width=$('lightbox').scrollWidth+'px';$('lightbox').style.margin="-"+$('lightbox').scrollHeight/2+"px 0 0 "
+"-"+$('lightbox').scrollWidth/2+"px";},show:function(url){this.content=url
if(Prototype.Browser.IE){this.getScroll();this.prepareIE('100%','hidden');this.setScroll(0,0);this.hideSelects('hidden');}
Element.update("lightbox_content","<p id='LoadMessage'></p>");this.displayLightbox("block");this.center_position();},addLightboxMarkup:function(){if($("overlay")!=null)return;bod=document.getElementsByTagName('body')[0];overlay=document.createElement('div');overlay.id='overlay';lb=document.createElement('div');lb.id='lightbox';title=document.createElement('div');title.id="lightbox_title";title.innerHTML="<a id='lightbox_close' href='#' onclick='Lightbox.close();'></a>"
lb.appendChild(title);lightbox_msg=document.createElement('div');lightbox_msg.id="lightbox_msg";lb.appendChild(lightbox_msg);lightbox_content=document.createElement('div');lightbox_content.id="lightbox_content";lb.appendChild(lightbox_content);document.body.appendChild(overlay);document.body.appendChild(lb);},prepareIE:function(height,overflow){bod=document.getElementsByTagName('body')[0];bod.style.height=height;bod.style.overflow=overflow;htm=document.getElementsByTagName('html')[0];htm.style.height=height;htm.style.overflow=overflow;},hideSelects:function(visibility){selects=document.getElementsByTagName('select');for(i=0;i<selects.length;i++){selects[i].style.visibility=visibility;}},getScroll:function(){if(self.pageYOffset){this.yPos=self.pageYOffset;}else if(document.documentElement&&document.documentElement.scrollTop){this.yPos=document.documentElement.scrollTop;}else if(document.body){this.yPos=document.body.scrollTop;}},setScroll:function(x,y){window.scrollTo(x,y);},displayLightbox:function(display){$('overlay').style.display=display;$('lightbox').style.display=display;if(display!='none')this.loadInfo();},loadInfo:function(){var myAjax=new Ajax.Request(this.content,{method:'get',parameters:"from=Lightbox",onComplete:this.processInfo.bindAsEventListener(this)});},processInfo:function(response){Element.update("lightbox_content",response.responseText);$('lightbox').className="done";this.center_position();},close:function(){Element.update('lightbox_content','');Element.update('lightbox_msg','');if(Prototype.Browser.IE){this.setScroll(0,this.yPos);this.prepareIE("auto","auto");this.hideSelects("visible");}
new Effect.Fade('overlay',{duration:0.4});this.displayLightbox("none");}}
function initialize(){Lightbox=new lightbox();}
var ValidationDefaultOptions=function(){};ValidationDefaultOptions.prototype={onSubmit:true,onReset:true,stopOnFirst:false,immediate:false,focusOnError:true,useTitles:false,onFormValidate:function(result,form){return result;},onElementValidate:function(result,elm){}}
var ValidatorDefaultOptions=function(){}
ValidatorDefaultOptions.prototype={ignoreEmptyValue:true,depends:[]}
if(typeof Prototype!='undefined'&&(typeof $!='undefined')){$prototype=$;}
Validator=Class.create();Validator.messageSource={};Validator.messageSource['en-us']=[['validation-failed','Validation failed.'],['required','This is a required field.'],['validate-number','Please enter a valid number in this field.'],['validate-digits','Please use numbers only in this field. please avoid spaces or other characters such as dots or commas.'],['validate-alpha','Please use letters only (a-z) in this field.'],['validate-alphanum','Please use only letters (a-z) or numbers (0-9) only in this field. No spaces or other characters are allowed.'],['validate-email','Please enter a valid email address. For example fred@domain.com .'],['validate-url','Please enter a valid URL.'],['validate-currency-dollar','Please enter a valid $ amount. For example $100.00 .'],['validate-one-required','Please select one of the above options.'],['validate-integer','Please enter a valid integer in this field'],['validate-pattern','Validation failed.'],['validate-ip','Please enter a valid IP address'],['min-value','min value is %s.'],['max-value','max value is %s.'],['min-length','min length is %s,current length is %s.'],['max-length','max length is %s,current length is %s.'],['int-range','Please enter integer value between %s and %s'],['float-range','Please enter number between %s and %s'],['length-range','Please enter value length between %s and %s,current length is %s'],['equals','Conflicting with above value.'],['less-than','Input value must be less than above value.'],['less-than-equal','Input value must be less than or equal above value.'],['great-than','Input value must be great than above value.'],['great-than-equal','Input value must be great than or equal above value.'],['validate-date','Please use this date format: %s. For example %s.'],['validate-selection','Please make a selection.'],['validate-file',function(v,elm,args,metadata){return ValidationUtils.format("Please enter file type in [%s]",[args.join(',')]);}],['validate-id-number','Please enter a valid id number.'],['validate-chinese','Please enter chinese'],['validate-phone','Please enter a valid phone number,current length is %s.'],['validate-mobile-phone','Please enter a valid mobile phone,For example 13910001000.current length is %s.'],['validate-zip','Please enter a valid zip code.'],['validate-qq','Please enter a valid qq number']]
Validator.messageSource['en']=Validator.messageSource['en-us']
Validator.messageSource['zh-cn']=[['validation-failed','.'],['required','.'],['validate-number','.'],['validate-digits','.'],['validate-alpha','.'],['validate-alphanum',',.'],['validate-email','.'],['validate-url','URL.'],['validate-currency-dollar','Please enter a valid $ amount. For example $100.00 .'],['validate-one-required','.'],['validate-integer',''],['validate-pattern',''],['validate-ip','IP'],['min-value','%s'],['max-value','%s'],['min-length','%s,%s.'],['max-length','%s,%s.'],['int-range',' %s  %s '],['float-range',' %s  %s '],['length-range',' %s  %s ,%s'],['equals',','],['less-than',''],['less-than-equal',''],['great-than',''],['great-than-equal',''],['validate-date',', %s. :%s.'],['validate-selection','.'],['validate-file',function(v,elm,args,metadata){return ValidationUtils.format("[%s]",[args.join(',')]);}],['validate-id-number',''],['validate-chinese',''],['validate-phone',',:010-29392929,%s.'],['validate-mobile-phone',',%s.'],['validate-zip',''],['validate-qq','QQ.']]
ValidationUtils={isVisible:function(elm){while(elm&&elm.tagName!='BODY'){if(!$prototype(elm).visible())return false;elm=elm.parentNode;}
return true;},getReferenceForm:function(elm){while(elm&&elm.tagName!='BODY'){if(elm.tagName=='FORM')return elm;elm=elm.parentNode;}
return null;},getInputValue:function(elm){var elm=$prototype(elm);if(elm.type.toLowerCase()=='file'){return elm.value;}else{return $F(elm);}},getElmID:function(elm){return elm.id?elm.id:elm.name;},format:function(str,args){args=args||[];ValidationUtils.assert(args.constructor==Array,"ValidationUtils.format() arguement 'args' must is Array");var result=str
for(var i=0;i<args.length;i++){result=result.replace(/%s/,args[i]);}
return result;},getArgumentsByClassName:function(prefix,className){if(!className||!prefix)
return[];var pattern=new RegExp(prefix+'-(\\S+)');var matchs=className.match(pattern);if(!matchs)
return[];var results=[];results.singleArgument=matchs[1];var args=matchs[1].split('-');for(var i=0;i<args.length;i++){if(args[i]==''){if(i+1<args.length)args[i+1]='-'+args[i+1];}else{results.push(args[i]);}}
return results;},assert:function(condition,message){var errorMessage=message||("assert failed error,condition="+condition);if(!condition){alert(errorMessage);throw new Error(errorMessage);}else{return condition;}},isDate:function(v,dateFormat){var MONTH="MM";var DAY="dd";var YEAR="yyyy";var regex='^'+dateFormat.replace(YEAR,'\\d{4}').replace(MONTH,'\\d{2}').replace(DAY,'\\d{2}')+'$';if(!new RegExp(regex).test(v))return false;var year=v.substr(dateFormat.indexOf(YEAR),4);var month=v.substr(dateFormat.indexOf(MONTH),2);var day=v.substr(dateFormat.indexOf(DAY),2);var d=new Date(ValidationUtils.format('%s/%s/%s',[year,month,day]));return(parseInt(month,10)==(1+d.getMonth()))&&(parseInt(day,10)==d.getDate())&&(parseInt(year,10)==d.getFullYear());},fireSubmit:function(form){var form=$prototype(form);if(form.fireEvent){if(form.fireEvent('onsubmit'))
form.submit();}else if(document.createEvent){var evt=document.createEvent("HTMLEvents");evt.initEvent('submit',false,true);form.dispatchEvent(evt);}},getLanguage:function(){var lang=null;if(typeof navigator.userLanguage=='undefined')
lang=navigator.language.toLowerCase();else
lang=navigator.userLanguage.toLowerCase();return lang;},getMessageSource:function(){var lang=ValidationUtils.getLanguage();var messageSource=Validator.messageSource['zh-cn'];if(Validator.messageSource[lang]){messageSource=Validator.messageSource[lang];}
var results={};for(var i=0;i<messageSource.length;i++){results[messageSource[i][0]]=messageSource[i][1];}
return results;},getI18nMsg:function(key){return ValidationUtils.getMessageSource()[key];}}
Validator.prototype={initialize:function(className,test,options){this.options=Object.extend(new ValidatorDefaultOptions(),options||{});this._test=test?test:function(v,elm){return true};this._error=ValidationUtils.getI18nMsg(className)?ValidationUtils.getI18nMsg(className):ValidationUtils.getI18nMsg('validation-failed');this.className=className;this._dependsTest=this._dependsTest.bind(this);this.testAndGetError=this.testAndGetError.bind(this);this.testAndGetDependsError=this.testAndGetDependsError.bind(this);},_dependsTest:function(v,elm){if(this.options.depends&&this.options.depends.length>0){var dependsResult=$A(this.options.depends).all(function(depend){return Validation.get(depend).test(v,elm);});return dependsResult;}
return true;},test:function(v,elm){if(!this._dependsTest(v,elm))
return false;if(!elm)elm={}
var isEmpty=(this.options.ignoreEmptyValue&&((v==null)||(v.length==0)));return isEmpty||this._test(v,elm,ValidationUtils.getArgumentsByClassName(this.className,elm.className),this);},testAndGetDependsError:function(v,elm){var depends=this.options.depends;if(depends&&depends.length>0){var dependsError=null;for(var i=0;i<depends.length;i++){var dependsError=Validation.get(depends[i]).testAndGetError(v,elm);if(dependsError)return dependsError;}}
return null;},testAndGetError:function(v,elm,useTitle){var dependsError=this.testAndGetDependsError(v,elm);if(dependsError)return dependsError;if(!elm)elm={}
var isEmpty=(this.options.ignoreEmptyValue&&((v==null)||(v.length==0)));var result=isEmpty||this._test(v,elm,ValidationUtils.getArgumentsByClassName(this.className,elm.className),this);if(!result)return this.error(v,elm,useTitle);return null;},error:function(v,elm,useTitle){var args=ValidationUtils.getArgumentsByClassName(this.className,elm.className);var error=this._error;if(typeof error=='string'){if(v)args.push(v.length);error=ValidationUtils.format(this._error,args);}else if(typeof error=='function'){error=error(v,elm,args,this);}else{alert('property "_error" must type of string or function,current type:'+typeof error+" current className:"+this.className);}
if(!useTitle)useTitle=elm.className.indexOf('useTitle')>=0;return useTitle?((elm&&elm.title)?elm.title:error):error;}}
var Validation=Class.create();Validation.prototype={initialize:function(form,options){this.options=Object.extend(new ValidationDefaultOptions(),options||{});this.form=$prototype(form);var formId=ValidationUtils.getElmID($prototype(form));Validation.validations[formId]=this;if(typeof(this.form.onsubmit)=='function')
{this.originSubmit=this.form.onsubmit.bind(this.form);}
this.form.onsubmit=this.onSubmit.bind(this);if(this.options.onReset)Event.observe(this.form,'reset',this.reset.bind(this),false);if(this.options.immediate){var useTitles=this.options.useTitles;var callback=this.options.onElementValidate;var elements=$A(Form.getElements(this.form));for(var i=0;i<elements.length;i++){var input=elements[i];Event.observe(input,'blur',function(ev){Validation.validateElement(Event.element(ev),{useTitle:useTitles,onElementValidate:callback});});}}},onSubmit:function(ev){if(!this.validate()){return false;}
else
if(this.originSubmit)
{return this.originSubmit(ev);}
return true;},validate:function(){var result=true;var useTitles=this.options.useTitles;var callback=this.options.onElementValidate;if(this.options.stopOnFirst){var elements=$A(Form.getElements(this.form));for(var i=0;i<elements.length;i++){var elm=elements[i];result=Validation.validateElement(elm,{useTitle:useTitles,onElementValidate:callback});if(!result)break;}}else{var elements=$A(Form.getElements(this.form));for(var i=0;i<elements.length;i++){var elm=elements[i];if(!Validation.validateElement(elm,{useTitle:useTitles,onElementValidate:callback})){result=false;}}}
if(!result&&this.options.focusOnError){var first=Form.getElements(this.form).findAll(function(elm){return $prototype(elm).hasClassName('validation-failed')})[0];if(first.select)first.select();first.focus();}
return this.options.onFormValidate(result,this.form);},reset:function(){var elements=$A(Form.getElements(this.form))
for(var i=0;i<elements.length;i++)
Validation.reset(elements[i]);}}
Object.extend(Validation,{validateElement:function(elm,options){options=Object.extend({useTitle:false,onElementValidate:function(result,elm){}},options||{});elm=$prototype(elm);var cn=$A(elm.classNames());for(var i=0;i<cn.length;i++){var value=cn[i];var test=Validation.test(value,elm,options.useTitle);options.onElementValidate(test,elm);if(!test)return false;}
return true;},newErrorMsgAdvice:function(name,elm,errorMsg){var advice='<div class="validation-advice" id="advice-'+name+'-'+ValidationUtils.getElmID(elm)+'" style="display:none">'+errorMsg+'</div>'
switch(elm.type.toLowerCase()){case'checkbox':case'radio':var p=elm.parentNode;if(p){new Insertion.Bottom(p,advice);}else{new Insertion.After(elm,advice);}
break;default:new Insertion.After(elm,advice);}
advice=this.getAdvice(name,elm);return advice;},showErrorMsg:function(name,elm,errorMsg){var elm=$prototype(elm);if(typeof Tooltip!='undefined'){if(!elm.tooltip){elm.tooltip=new Tooltip(elm,{backgroundColor:"#FC9",borderColor:"#C96",textColor:"#000",textShadowColor:"#FFF"});}
elm.tooltip.content=errorMsg;}else{var prop=Validation._getAdviceProp(name);var advice=Validation.getAdvice(name,elm);if(!elm[prop]){if(!advice){advice=Validation.newErrorMsgAdvice(name,elm,errorMsg);}}
if(advice&&!advice.visible()){if(typeof Effect=='undefined'){advice.style.display='';}else{new Effect.Appear(advice,{duration:1});}}
if(advice.innerHTML!=errorMsg)
{advice.innerHTML=errorMsg;}
elm[prop]=true;}
elm.removeClassName('validation-passed');elm.addClassName('validation-failed');},hideErrorMsg:function(name,elm){var elm=$prototype(elm);if(typeof Tooltip!='undefined'){if(elm.tooltip){elm.tooltip.stop();elm.tooltip=false;}}else{var prop=Validation._getAdviceProp(name);var advice=Validation.getAdvice(name,elm);if(advice&&elm[prop]){if(typeof Effect=='undefined')
advice.hide()
else
new Effect.Fade(advice,{duration:1});}
elm[prop]=false;}
elm.removeClassName('validation-failed');elm.addClassName('validation-passed');},_getAdviceProp:function(validatorName){return'__advice'+validatorName;},test:function(name,elm,useTitle){var v=Validation.get(name);var errorMsg=null;if(ValidationUtils.isVisible(elm))
errorMsg=v.testAndGetError(ValidationUtils.getInputValue(elm),elm,useTitle);if(errorMsg){Validation.showErrorMsg(name,elm,errorMsg);return false;}else{Validation.hideErrorMsg(name,elm);return true;}},getAdvice:function(name,elm){return $prototype('advice-'+name+'-'+ValidationUtils.getElmID(elm))||$prototype('advice-'+ValidationUtils.getElmID(elm));},reset:function(elm){elm=$prototype(elm);var cn=$A(elm.classNames());for(var i=0;i<cn.length;i++){var value=cn[i];var prop=Validation._getAdviceProp(value);if(elm[prop]){var advice=Validation.getAdvice(value,elm);advice.hide();elm[prop]='';}
elm.removeClassName('validation-failed');elm.removeClassName('validation-passed');}},add:function(className,test,options){var nv={};var testFun=test;if(test instanceof RegExp)
testFun=function(v,elm,args,metadata){return test.test(v);}
nv[className]=new Validator(className,testFun,options);Object.extend(Validation.methods,nv);},addAllThese:function(validators){var validators=$A(validators);for(var i=0;i<validators.length;i++){var value=validators[i];Validation.add(value[0],value[1],(value.length>2?value[2]:{}));}},get:function(name){var resultMethodName;for(var methodName in Validation.methods){if(name==methodName){resultMethodName=methodName;break;}
if(name.indexOf(methodName)>=0){resultMethodName=methodName;}}
return Validation.methods[resultMethodName]?Validation.methods[resultMethodName]:new Validator();},$:function(formId){return Validation.validations[formId];},methods:{},validations:{}});Validation.addAllThese([['required',function(v){return!((v==null)||(v.length==0)||/^[\s|\u3000]+$/.test(v));},{ignoreEmptyValue:false}],['validate-number',function(v){return(!isNaN(v)&&!/^\s+$/.test(v));}],['validate-digits',function(v){return!/[^\d]/.test(v);}],['validate-alphanum',function(v){return!/\W/.test(v)}],['validate-one-required',function(v,elm){var p=elm.parentNode;var options=p.getElementsByTagName('INPUT');return $A(options).any(function(elm){return $F(elm);});},{ignoreEmptyValue:false}],['validate-digits',/^[\d]+$/],['validate-alphanum',/^[a-zA-Z0-9]+$/],['validate-alpha',/^[a-zA-Z]+$/],['validate-email',/\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/],['validate-url',/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i],['validate-currency-dollar',/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/]]);Validation.addAllThese([['equals',function(v,elm,args,metadata){return $F(args[0])==v;},{ignoreEmptyValue:false}],['less-than',function(v,elm,args,metadata){if(Validation.get('validate-number').test(v)&&Validation.get('validate-number').test($F(args[0])))
return parseFloat(v)<parseFloat($F(args[0]));return v<$F(args[0]);}],['less-than-equal',function(v,elm,args,metadata){if(Validation.get('validate-number').test(v)&&Validation.get('validate-number').test($F(args[0])))
return parseFloat(v)<=parseFloat($F(args[0]));return v<$F(args[0])||v==$F(args[0]);}],['great-than',function(v,elm,args,metadata){if(Validation.get('validate-number').test(v)&&Validation.get('validate-number').test($F(args[0])))
return parseFloat(v)>parseFloat($F(args[0]));return v>$F(args[0]);}],['great-than-equal',function(v,elm,args,metadata){if(Validation.get('validate-number').test(v)&&Validation.get('validate-number').test($F(args[0])))
return parseFloat(v)>=parseFloat($F(args[0]));return v>$F(args[0])||v==$F(args[0]);}],['min-length',function(v,elm,args,metadata){return v.length>=parseInt(args[0]);}],['max-length',function(v,elm,args,metadata){return v.length<=parseInt(args[0]);}],['validate-file',function(v,elm,args,metadata){return $A(args).any(function(extentionName){return new RegExp('\\.'+extentionName+'$','i').test(v);});}],['float-range',function(v,elm,args,metadata){return(parseFloat(v)>=parseFloat(args[0])&&parseFloat(v)<=parseFloat(args[1]))},{depends:['validate-number']}],['int-range',function(v,elm,args,metadata){return(parseInt(v)>=parseInt(args[0])&&parseInt(v)<=parseInt(args[1]))},{depends:['validate-integer']}],['length-range',function(v,elm,args,metadata){return(v.length>=parseInt(args[0])&&v.length<=parseInt(args[1]))}],['max-value',function(v,elm,args,metadata){return parseFloat(v)<=parseFloat(args[0]);},{depends:['validate-number']}],['min-value',function(v,elm,args,metadata){return parseFloat(v)>=parseFloat(args[0]);},{depends:['validate-number']}],['validate-pattern',function(v,elm,args,metadata){return eval('('+args.singleArgument+'.test(v))');}],['validate-ajax',function(v,elm,args,metadata){var form=ValidationUtils.getReferenceForm(elm);var params=(form?Form.serialize(form):Form.Element.serialize(elm));params+=ValidationUtils.format("&what=%s&value=%s",[elm.name,encodeURIComponent(v)]);var request=new Ajax.Request(args.singleArgument,{parameters:params,asynchronous:false,method:"get"});var responseText=request.transport.responseText;if(""==responseText.strip())return true;metadata._error=responseText;return false;}],['validate-dwr',function(v,elm,args,metadata){var result=false;var callback=function(methodResult){if(methodResult)
metadata._error=methodResult;else
result=true;}
var call=args.singleArgument+"('"+v+"',callback)";DWREngine.setAsync(false);eval(call);DWREngine.setAsync(true);return result;}],['validate-buffalo',function(v,elm,args,metadata){var result=false;var callback=function(reply){if(replay.getResult())
metadata._error=replay.getResult();else
result=true;}
if(!BUFFALO_END_POINT)alert('not found "BUFFALO_END_POINT" variable');var buffalo=new Buffalo(BUFFALO_END_POINT,false);buffalo.remoteCall(args.singleArgument,v,callback);return result;}],['validate-date',function(v,elm,args,metadata){var dateFormat=args.singleArgument||'yyyy-MM-dd';metadata._error=ValidationUtils.format(ValidationUtils.getI18nMsg(metadata.className),[dateFormat,dateFormat.replace('yyyy','2006').replace('MM','03').replace('dd','12')]);return ValidationUtils.isDate(v,dateFormat);}],['validate-selection',function(v,elm,args,metadata){return elm.options?elm.selectedIndex>0:!((v==null)||(v.length==0));}],['validate-integer',/^[-+]?[1-9]\d*$|^0$/],['validate-ip',/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/],['validate-id-number',function(v,elm,args,metadata){if(!(/^\d{17}(\d|x)$/i.test(v)||/^\d{15}$/i.test(v)))return false;var provinceCode=parseInt(v.substr(0,2));if((provinceCode<11)||(provinceCode>91))return false;var forTestDate=v.length==18?v:v.substr(0,6)+"19"+v.substr(6,15);var birthday=forTestDate.substr(6,8);if(!ValidationUtils.isDate(birthday,'yyyyMMdd'))return false;if(v.length==18){v=v.replace(/x$/i,"a");var verifyCode=0;for(var i=17;i>=0;i--)
verifyCode+=(Math.pow(2,i)%11)*parseInt(v.charAt(17-i),11);if(verifyCode%11!=1)return false;}
return true;}],['validate-chinese',/^[\u4e00-\u9fa5]+$/],['validate-phone',/^((0[1-9]{3})?(0[12][0-9])?[-])?\d{6,8}$/],['validate-mobile-phone',/(^0?[1][358][0-9]{9}$)/],['validate-zip',/^[1-9]\d{5}$/],['validate-qq',/^[1-9]\d{4,8}$/]]);Validation.autoBind=function(){var forms=$A(document.getElementsByClassName('required-validate'));for(var i=0;i<forms.length;i++){var form=forms[i];var validation=new Validation(form,{immediate:true,useTitles:true,stopOnFirst:true});Event.observe(form,'reset',function(){validation.reset();},false);}};Event.observe(window,'load',Validation.autoBind,false);TextDefaultValue=Class.create();TextDefaultValue.prototype={initialize:function(inputTextID,defaultText,options){this.inputText=$(inputTextID);var parentForm=this.inputText.up("form");this.options=options||{default_text_color:"gray"};this.defaultValue=defaultText;this.isPassword=this.inputText.type&&this.inputText.type=='password';if(this.isPassword)
{this.clone_input=this.clone_input_password();this.inputText.hide();new Insertion.After(this.inputText,this.clone_input);this.clone_input.observe('focus',function(){this.inputText.show();this.clone_input.hide();setTimeout(function(){this.inputText.focus();}.bind(this),1);}.bindAsEventListener(this));this.inputText.observe('blur',function(){if($F(this.inputText)===""){this.clone_input.show();this.inputText.hide();}}.bindAsEventListener(this));}
else
{this.inputText.style.color=this.options.default_text_color;if(!this.inputText.value||this.inputText.value=='')
{this.inputText.value=this.defaultValue;}
this.inputText.observe('focus',function(){if(this.inputText.value==this.defaultValue){this.inputText.value='';this.inputText.style.color='';}}.bindAsEventListener(this));this.inputText.observe('blur',function(){if(this.inputText.value=='')
{if(this.isPassword)this.inputText.type='text';this.inputText.value=this.defaultValue;this.inputText.style.color=this.options.default_text_color;}}.bindAsEventListener(this));}
if(parentForm){if(typeof(parentForm.onsubmit)=='function')
{this.originSubmit=parentForm.onsubmit.bind(parentForm);}
parentForm.onsubmit=function(ev){if(this.inputText.value==this.defaultValue)
{this.inputText.value="";}
if(this.originSubmit)
{return this.originSubmit(ev);}
return true;}.bind(this)}},clone_input_password:function(){clone_input=document.createElement("input");clone_input.setAttribute("style",this.inputText.style);clone_input.style.color=this.options.default_text_color;clone_input.value=this.defaultValue;clone_input.type="text";clone_input.className=this.inputText.className;return $(clone_input);}}
TextDefaultValue.autoBind=function(){var elms=$A(document.getElementsByClassName('default_value'));for(var i=0;i<elms.length;i++){var elm=elms[i];new TextDefaultValue(elm,elm.title);}};Event.observe(window,'load',TextDefaultValue.autoBind,false);function StarRank(){}
StarRank.prototype={titles:new Array('1','2','3','4','5'),imgEmpty_class:'output_empty_star',imgOver_class:'input_full_star',imgFull_class:'output_full_star',links:null,id:null,rankValue:0,disabled:false,disabledMessage:'^_^',setRankValue:function(value){if(typeof(value)!='undefined'&&value!=null){this.rankValue=Number(value);this.refresh();}},refresh:function(){for(var i=0;i<this.links.length;i++)
{if(this.rankValue>i){this.links[i].className=this.imgFull_class;}else{this.links[i].className=this.imgEmpty_class;}}
Element.update(this.title,this.titles[this.rankValue-1]||'&nbsp;');},create:function(divParent,id){this.create=null;var _self=this;this.id=id;this.links=new Array(5);this.title=document.createElement("span");this.title.setAttribute('style',"DISPLAY: inline-block;");Element.update(this.title,'&nbsp;&nbsp;');for(var i=5;i>=1;i--){var lnk1;if(this.disabled)
{lnk1=document.createElement("span");}
else{lnk1=document.createElement("a");lnk1.setAttribute('href',"javascript:;");}
lnk1.setAttribute('rank',i);lnk1.setAttribute('style',"background-color:transparent; ");lnk1.setAttribute('id',"rankimg"+id+"i"+i);lnk1.setAttribute('class',this.imgEmpty_class);lnk1.setAttribute('title',this.titles[i-1]);Event.observe($(lnk1),'click',function(){_self.rankPreClick(_self,id,this.getAttribute('rank'));});Event.observe(lnk1,'mouseover',function(){_self.rankPreMouseOver(_self,id,this.getAttribute('rank'));});Event.observe(lnk1,'mouseout',function(){_self.rankPreMouseOut(_self,id,this.getAttribute('rank'));});$(divParent).insertBefore(lnk1,$(divParent).childNodes[0]);this.links[i-1]=lnk1;}
$(divParent).insert(this.title);this.refresh();},callback:function(type,message){},rankClick:function(sender,id,value){},rankPreClick:function(sender,id,value){if(this.disabled){this.callback('warn',this.disabledMessage);return;}
this.rankValue=value;this.refresh();this.rankClick(sender,id,value);},rankMouseOver:function(sender,id,value){},rankPreMouseOver:function(sender,id,value){if(!this.disabled){for(var i=0;i<this.links.length;i++)
{if(value>i){this.links[i].className=this.imgOver_class;}else{this.links[i].className=this.imgEmpty_class;}}}
Element.update(this.title,this.titles[value-1]);this.rankMouseOver(sender,id,value);},rankMouseOut:function(sender,id,value){},rankPreMouseOut:function(sender,id,value){this.refresh();this.rankMouseOut(sender,id,value);}}
String.prototype.find=function(what){return(this.indexOf(what)>=0?true:false);}
function Nifty(selector,options){var i,v=selector.split(","),h=0;if(options==null)options="";if(options.find("fixed-height"))
h=getElementsBySelector(v[0])[0].offsetHeight;for(i=0;i<v.length;i++)
Rounded(v[i],options);if(options.find("height"))SameHeight(selector,h);}
function Rounded(selector,options){var i,top="",bottom="",v=new Array();if(options!=""){options=options.replace("left","tl bl");options=options.replace("right","tr br");options=options.replace("top","tr tl");options=options.replace("bottom","br bl");options=options.replace("transparent","alias");if(options.find("tl")){top="both";if(!options.find("tr"))top="left";}
else if(options.find("tr"))top="right";if(options.find("bl")){bottom="both";if(!options.find("br"))bottom="left";}
else if(options.find("br"))bottom="right";}
if(top==""&&bottom==""&&!options.find("none")){top="both";bottom="both";}
v=getElementsBySelector(selector);for(i=0;i<v.length;i++){FixIE(v[i]);if(top!="")AddTop(v[i],top,options);if(bottom!="")AddBottom(v[i],bottom,options);}}
function AddTop(el,side,options){var d=CreateEl("b"),lim=4,border="",p,i,btype="r",bk,color;d.style.marginLeft="-"+getPadding(el,"Left")+"px";d.style.marginRight="-"+getPadding(el,"Right")+"px";if(options.find("alias")||(color=getBk(el))=="transparent"){color="transparent";bk="transparent";border=getParentBk(el);btype="t";}
else{bk=getParentBk(el);border=Mix(color,bk);}
d.style.background=bk;d.className="niftycorners";p=getPadding(el,"Top");if(options.find("small")){d.style.marginBottom=(p-2)+"px";btype+="s";lim=2;}
else if(options.find("big")){d.style.marginBottom=(p-10)+"px";btype+="b";lim=8;}
else d.style.marginBottom=(p-5)+"px";for(i=1;i<=lim;i++)
d.appendChild(CreateStrip(i,side,color,border,btype));el.style.paddingTop="0";el.insertBefore(d,el.firstChild);}
function AddBottom(el,side,options){var d=CreateEl("b"),lim=4,border="",p,i,btype="r",bk,color;d.style.marginLeft="-"+getPadding(el,"Left")+"px";d.style.marginRight="-"+getPadding(el,"Right")+"px";if(options.find("alias")||(color=getBk(el))=="transparent"){color="transparent";bk="transparent";border=getParentBk(el);btype="t";}
else{bk=getParentBk(el);border=Mix(color,bk);}
d.style.background=bk;d.className="niftycorners";p=getPadding(el,"Bottom");if(options.find("small")){d.style.marginTop=(p-2)+"px";btype+="s";lim=2;}
else if(options.find("big")){d.style.marginTop=(p-10)+"px";btype+="b";lim=8;}
else d.style.marginTop=(p-5)+"px";for(i=lim;i>0;i--)
d.appendChild(CreateStrip(i,side,color,border,btype));el.style.paddingBottom=0;el.appendChild(d);}
function CreateStrip(index,side,color,border,btype){var x=CreateEl("b");x.className=btype+index;x.style.backgroundColor=color;x.style.borderColor=border;if(side=="left"){x.style.borderRightWidth="0";x.style.marginRight="0";}
else if(side=="right"){x.style.borderLeftWidth="0";x.style.marginLeft="0";}
return(x);}
function CreateEl(x){return(document.createElement(x));}
function FixIE(el){if(el.currentStyle!=null&&el.currentStyle.hasLayout!=null&&el.currentStyle.hasLayout==false)
el.style.display="inline-block";}
function SameHeight(selector,maxh){var i,v=selector.split(","),t,j,els=[],gap;for(i=0;i<v.length;i++){t=getElementsBySelector(v[i]);els=els.concat(t);}
for(i=0;i<els.length;i++){if(els[i].offsetHeight>maxh)maxh=els[i].offsetHeight;els[i].style.height="auto";}
for(i=0;i<els.length;i++){gap=maxh-els[i].offsetHeight;if(gap>0){t=CreateEl("b");t.className="niftyfill";t.style.height=gap+"px";nc=els[i].lastChild;if(nc.className=="niftycorners")
els[i].insertBefore(t,nc);else els[i].appendChild(t);}}}
function getElementsBySelector(selector){return $$(selector);}
function getParentBk(x){var el=x.parentNode,c;while(el.tagName.toUpperCase()!="HTML"&&(c=getBk(el))=="transparent")
el=el.parentNode;if(c=="transparent")c="#FFFFFF";return(c);}
function getBk(x){var c=Element.getStyle(x,"backgroundColor");if(c==null||c=="transparent"||c.find("rgba(0, 0, 0, 0)"))
return("transparent");if(c.find("rgb"))c=rgb2hex(c);return(c);}
function getPadding(x,side){var p=Element.getStyle(x,"padding"+side);if(p==null||!p.find("px"))return(0);return(parseInt(p));}
function rgb2hex(value){var hex="",v,h,i;var regexp=/([0-9]+)[, ]+([0-9]+)[, ]+([0-9]+)/;var h=regexp.exec(value);for(i=1;i<4;i++){v=parseInt(h[i]).toString(16);if(v.length==1)hex+="0"+v;else hex+=v;}
return("#"+hex);}
function Mix(c1,c2){var i,step1,step2,x,y,r=new Array(3);if(c1.length==4)step1=1;else step1=2;if(c2.length==4)step2=1;else step2=2;for(i=0;i<3;i++){x=parseInt(c1.substr(1+step1*i,step1),16);if(step1==1)x=16*x+x;y=parseInt(c2.substr(1+step2*i,step2),16);if(step2==1)y=16*y+y;r[i]=Math.floor((x*50+y*50)/100);r[i]=r[i].toString(16);if(r[i].length==1)r[i]="0"+r[i];}
return("#"+r[0]+r[1]+r[2]);}
var Fabtabs=Class.create({initialize:function(element,options){var parent=this.element=$(element);this.options=Object.extend({hover:false,remotehover:false,anchorpolicy:'allow-initial'},options||{});this.menu=this.element.select('a[href*="#"]');this.hrefs=this.menu.map(function(elm){return elm.href.match(/#(\w.+)/)?RegExp.$1:null;}).compact();this.on(this.getInitialTab());var onLocal=function(event){if(this.options.anchorpolicy!=='allow'){event.stop();}
var elm=event.findElement("a");if(!elm)return;this.activate(elm);if(this.options.anchorpolicy==='protect'){window.location.hash='.'+this.tabID(elm);}};var onRemote=function(event){if(this.options.anchorpolicy!=='allow'){event.stop();}
var trig=event.findElement("a");this.activate(this.tabID(trig));if(this.options.anchorpolicy==='protect'){window.location.hash='.'+this.tabID(elm);}}
this.element.observe('click',onLocal.bindAsEventListener(this));if(this.options.hover){this.menu.each(function(elm){elm.observe('mouseover',onLocal.bindAsEventListener(this))}.bind(this));}
var triggers=[];this.hrefs.each(function(id){$$('a[href="#'+id+'"]').reject(function(elm){return elm.descendantOf(parent)}).each(function(trig){triggers.push(trig);});})
triggers.each(function(elm){elm.observe('click',onRemote.bindAsEventListener(this));if(this.options.remotehover){elm.observe('mouseover',onRemote.bindAsEventListener(this));}}.bind(this));},activate:function(elm){if(typeof elm=='string'){elm=this.element.select('a[href="#'+elm+'"]')[0];}
this.on(elm);this.menu.without(elm).each(this.off.bind(this));},off:function(elm){$(elm).removeClassName('active-tab');$(this.tabID(elm)).removeClassName('active-tab-body');},on:function(elm){$(elm).addClassName('active-tab');$(this.tabID(elm)).addClassName('active-tab-body');},tabID:function(elm){return elm.href.match(this.re)[1];},getInitialTab:function(){if(this.options.anchorpolicy!=='disable'&&document.location.href.match(this.re)){var hash=RegExp.$1;if(hash.substring(0,1)=="."){hash=hash.substring(1);}
return this.element.select('a[href="#'+hash+'"]')[0];}else{return this.menu.first();}},re:/#(\.?\w.+)/});document.observe("dom:loaded",function(){$$(".tabs").each(function(el){new Fabtabs(el);});});DynamicPopmenu=Class.create();DynamicPopmenu.prototype={initialize:function(target,popElement,target_event){if(target!=null)
{this.target=$(target);this.popElement=$(popElement);if((typeof(target_event)=="undefined")||(target_event=='click'))
{Event.observe(this.target,'click',this.onclick.bind(this));Event.observe(document,'click',this.ondocumentClick.bind(this));}
else
{Event.observe(this.target,'mouseover',this.onclick.bind(this));Event.observe(this.target,'mouseout',function(e){this.popElement.style.display="none";}.bind(this));}}},ondocumentClick:function(event){var obj=event.target;if(obj!=this.target&&obj!=this.popElement){this.popElement.style.display="none";}},onclick:function(event){if(this.popElement.style.display=="block"){this.popElement.style.display="none";}
else{this.popElement.style.left=this.target.cumulativeOffset()[0]+"px";this.popElement.style.top=this.target.cumulativeOffset()[1]+this.target.offsetHeight+"px";this.popElement.style.display="block";}
return false;}}
TagInput=Class.create();TagInput.prototype={initialize:function(tag_input_element,tags_element,options){this.options=options||{};this.options.splitStr=this.options.splitStr||" ";this.options.disableClass=this.options.disableClass||"disable_tag";if(typeof(tag_input_element)=='undefined'||tag_input_element=="")
return;this.tag_input=$(tag_input_element);this.tags_element=tags_element;$$(this.tags_element).each(function(el){Event.observe(el,'click',this.onclick.bindAsEventListener(this));}.bind(this))
Event.observe(this.tag_input,'keyup',this.onkeyup.bindAsEventListener(this));this.input_tag_test();},onkeyup:function(){this.input_tag_test();},onclick:function(event){event_el_value=event.target.innerHTML.strip();tag_values=$F(this.tag_input).split(this.options.splitStr);search_index=-1;for(var i in tag_values)
if(tag_values[i]==event_el_value)
{search_index=this.tag_input.value.search(event_el_value);break;}
if(search_index>-1)
if(search_index==0)
this.tag_input.value=this.tag_input.value.replace(event_el_value,"");else
this.tag_input.value=this.tag_input.value.replace(this.options.splitStr+event_el_value,"");else
if(this.tag_input.value.strip()=="")
this.tag_input.value=event_el_value;else
this.tag_input.value+=this.options.splitStr+event_el_value;this.input_tag_test();},input_tag_test:function()
{tag_values=$F(this.tag_input).split(this.options.splitStr);tag_els=$$(this.tags_element);for(var i=0;i<tag_els.length;i++)
{var el=tag_els[i];for(j in tag_values)
{value=tag_values[j]
if(value.length>10)
{alert('"'+value+'" ');}
else if(el.innerHTML.strip()==value)
{Element.addClassName(el,this.options.disableClass);break;}
else
{Element.removeClassName(el,this.options.disableClass);}}}}}
DropList=Class.create();DropList.prototype={initialize:function(src_select,target_select,array_value){this.src_select=$(src_select);this.option_collection=array_value
this.target_select=$(target_select);Event.observe(this.src_select,'change',this.onchange.bindAsEventListener(this));for(var i=0;i<this.option_collection[this.src_select.value].length;i++){this.target_select.options[i]=new Option(this.option_collection[this.src_select.value][i][1],this.option_collection[this.src_select.value][i][0]);}},onchange:function(event){this.target_select.options.length=0;for(var i=0;i<this.option_collection[this.src_select.value].length;i++){this.target_select.options[i]=new Option(this.option_collection[this.src_select.value][i][1],this.option_collection[this.src_select.value][i][0]);}}}
function PerpareNew(element)
{el=$(element);if(!el)return;el.show();el.scrollIntoView();el.select("Form").each(function(el){el.reset();el.focusFirstElement();});}
function PerpareEdit(element)
{el=$(element);if(!el)return;el.hide();el_container=$("edit_container_"+element);if(!el_container)return;el_container.show();}
Ajax.Responders.register({onCreate:function(requester,xhrObject){if(Ajax.activeRequestCount>0)
{if(requester&&requester.container&&requester.container["success"])
{$(requester.container["success"]).update("<p class='loading'></p>","top");}}},onComplete:function(requester){if(Ajax.activeRequestCount==0)
{if(requester&&requester.container&&requester.container["success"]&&$(requester.container["success"]).select(".loading"))
{$(requester.container["success"]).select(".loading").each(function(el){el.remove();});}}}});function AddHover(element){section_el=$(element);section_el.select(".edit_section").each(function(el){Event.observe(el,"mouseover",function(){this.addClassName("hover");this.setAttribute('style','');});Event.observe(el,"mouseout",function(){this.removeClassName("hover");});});}
Event.observe(window,"load",function(){Nifty('#nav a',"top");Nifty('div.main_info');Nifty('div.user_icon',"small");});function SetCookie(Cookie_name,value)
{
var Then=new Date()
Then.setTime(Then.getTime()+2*3600000)
document.cookie=Cookie_name+"="+value+";expires="+Then.toGMTString()}
function GetCookie(Cookie_name)
{
var cookieString=new String(document.cookie)
var cookieHeader=Cookie_name+"="
var beginPosition=cookieString.indexOf(cookieHeader)
if(beginPosition!=-1)
{
return cookieString.substring(beginPosition+cookieHeader.length);
}
else
{
 return null;
}}
function MoveCookie(Cookie_name)
{
document.cookie=Cookie_name+"=;expires=Fri, 02-Jan-1970 00:00:00 GMT";}