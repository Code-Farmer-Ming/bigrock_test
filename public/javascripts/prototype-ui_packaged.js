if(typeof Prototype=='undefined'||!Prototype.Version.match("1.6"))
throw("Prototype-UI library require Prototype library >= 1.6.0");(function(p){var b=p.Browser,n=navigator;if(b.WebKit){b.WebKitVersion=parseFloat(n.userAgent.match(/AppleWebKit\/([\d\.\+]*)/)[1]);b.Safari2=(b.WebKitVersion<420);}
if(b.IE){b.IEVersion=parseFloat(n.appVersion.split(';')[1].strip().split(' ')[1]);b.IE6=b.IEVersion==6;b.IE7=b.IEVersion==7;}
p.falseFunction=function(){return false};p.trueFunction=function(){return true};})(Prototype);var UI={Abstract:{},Ajax:{}};Object.extend(Class.Methods,{extend:Object.extend.methodize(),addMethods:Class.Methods.addMethods.wrap(function(proceed,source){if(!source)return this;if(!source.hasOwnProperty('methodsAdded'))
return proceed(source);var callback=source.methodsAdded;delete source.methodsAdded;proceed(source);callback.call(source,this);source.methodsAdded=callback;return this;}),addMethod:function(name,lambda){var methods={};methods[name]=lambda;return this.addMethods(methods);},method:function(name){return this.prototype[name].valueOf();},classMethod:function(){$A(arguments).flatten().each(function(method){this[method]=(function(){return this[method].apply(this,arguments);}).bind(this.prototype);},this);return this;},undefMethod:function(name){this.prototype[name]=undefined;return this;},removeMethod:function(name){delete this.prototype[name];return this;},aliasMethod:function(newName,name){this.prototype[newName]=this.prototype[name];return this;},aliasMethodChain:function(target,feature){feature=feature.camelcase();this.aliasMethod(target+"Without"+feature,target);this.aliasMethod(target,target+"With"+feature);return this;}});Object.extend(String.prototype,{camelcase:function(){var string=this.dasherize().camelize();return string.charAt(0).toUpperCase()+string.slice(1);},makeElement:function(){var wrapper=new Element('div');wrapper.innerHTML=this;return wrapper.down();}});Object.extend(Array.prototype,{isEmpty:function(){return!this.length;},at:function(index){return this[index<0?this.length+index:index];},removeAt:function(index){if(-index>this.length)return;return this.splice(index,1)[0];},removeIf:function(iterator,context){for(var i=this.length-1,objects=[];i>=0;i--)
if(iterator.call(context,this[i],i))
objects.push(this.removeAt(i));return objects.reverse();},remove:function(object){return this.removeIf(function(member){return member===object}).length;},insert:function(index){if(index>this.length)
this.length=index;else if(index<0)
index=this.length+index+1;this.splice.apply(this,[index,0].concat($A(arguments).slice(1)));return this;}});Array.prototype.empty=Array.prototype.isEmpty;Element.addMethods({getScrollDimensions:function(element){element=$(element);return{width:element.scrollWidth,height:element.scrollHeight}},getScrollOffset:function(element){element=$(element);return Element._returnOffset(element.scrollLeft,element.scrollTop);},setScrollOffset:function(element,offset){element=$(element);if(arguments.length==3)
offset={left:offset,top:arguments[2]};element.scrollLeft=offset.left;element.scrollTop=offset.top;return element;},getNumStyle:function(element,style){var value=parseFloat($(element).getStyle(style));return isNaN(value)?null:value;},appendText:function(element,text){element=$(element);element.appendChild(document.createTextNode(String.interpret(text)));return element;}});document.whenReady=(function(){var queue=[];document.observe('dom:loaded',function(){queue.invoke('call',document);queue.clear();document.whenReady=function(callback){callback.bind(document).defer()};});return function(callback){queue.push(callback)};})();Object.extend(document.viewport,{getScrollOffset:document.viewport.getScrollOffsets,setScrollOffset:function(offset){Element.setScrollOffset(Prototype.Browser.WebKit?document.body:document.documentElement,offset);},getScrollDimensions:function(){return Element.getScrollDimensions(Prototype.Browser.WebKit?document.body:document.documentElement);}});document.whenReady(function(){window.$head=$(document.getElementsByTagName('head')[0]);window.$body=$(document.body);});(function(){UI.Options={methodsAdded:function(klass){klass.classMethod($w(' setOptions allOptions optionsGetter optionsSetter optionsAccessor '));},setOptions:function(options){if(!this.hasOwnProperty('options'))
this.options=this.allOptions();this.options=Object.extend(this.options,options||{});},allOptions:function(){var superclass=this.constructor.superclass,ancestor=superclass&&superclass.prototype;return(ancestor&&ancestor.allOptions)?Object.extend(ancestor.allOptions(),this.options):Object.clone(this.options);},optionsGetter:function(){addOptionsAccessors(this,arguments,false);},optionsSetter:function(){addOptionsAccessors(this,arguments,true);},optionsAccessor:function(){this.optionsGetter.apply(this,arguments);this.optionsSetter.apply(this,arguments);}};function addOptionsAccessors(receiver,names,areSetters){names=$A(names).flatten();if(names.empty())
names=Object.keys(receiver.allOptions());names.each(function(name){var accessorName=(areSetters?'set':'get')+name.camelcase();receiver[accessorName]=receiver[accessorName]||(areSetters?function(value){return this.options[name]=value}:function(){return this.options[name]});});}})();UI.PullDown=Class.create(UI.Options,{options:{className:'',shadow:false,position:'over',cloneWidth:false,beforeShow:null,afterShow:null,beforeUpdate:null,afterUpdate:null,afterCreate:null},initialize:function(container,options){this.setOptions(options);this.container=$(container);this.element=new Element('div',{className:'UI-widget-dropdown '+this.options.className,style:'z-index:999999;position:absolute;'}).hide();this.container.insert({after:this.element})
if(this.options.shadow)
this.shadow=new UI.Shadow(this.element,{theme:this.options.shadow}).hide();else
this.iframe=Prototype.Browser.IE?new UI.IframeShim().hide():null;this.outsideClickHandler=this.outsideClick.bind(this);this.placeHandler=this.place.bind(this);this.hideHandler=this.hide.bind(this);},destroy:function(){if(this.active)
this.element.remove();this.element=null;this.stopObserving();},insert:function(elem){return this.element.insert(elem);},place:function(){this.element.clonePosition_new(this.container,{setHeight:false,setWidth:this.options.cloneWidth,offsetTop:this.options.position=='below'?this.container.offsetHeight:0});var w=this.element.getWidth();var h=this.element.getHeight();var t=parseInt(this.element.style.top);var l=parseInt(this.element.style.left);if(this.shadow)
this.shadow.setBounds({top:t,left:l,width:w,height:h});if(this.iframe)
{this.iframe.setPosition(t,l).setSize(w,h);}
return this;},show:function(event){if(this.active)
return this;this.active=true;this.place();if(this.options.beforeShow)
this.options.beforeShow(this);if(this.iframe)
this.iframe.show();if(this.shadow)
this.shadow.show();this.element.show();if(this.options.afterShow)
this.options.afterShow(this);document.observe('mousedown',this.outsideClickHandler);Event.observe(window,'scroll',this.placeHandler);Event.observe(window,'resize',this.outsideClickHandler);return this;},outsideClick:function(event){if(event.findElement('.UI-widget-dropdown'))
return;},hide:function(){if(this.active){this.active=false;this.element.hide();if(this.shadow)
this.shadow.hide();if(this.iframe)
this.iframe.hide();}
this.stopObserving();return this;},stopObserving:function(){Event.stopObserving(window,'resize',this.hideHandler);Event.stopObserving(window,'scroll',this.placeHandler);document.stopObserving('click',this.outsideClickHandler);}});UI.Shadow=Class.create(UI.Options,{options:{theme:"mac_shadow",focus:false,zIndex:100,withIFrameShim:true},initialize:function(element,options){this.setOptions(options);this.element=$(element);this.create();this.iframe=Prototype.Browser.IE&&this.options.withIFrameShim?new UI.IframeShim():null;if(Object.isElement(this.element.parentNode))
this.render();},destroy:function(){if(this.shadow.parentNode)
this.remove();},setPosition:function(top,left){if(this.shadowSize){var shadowStyle=this.shadow.style;top=parseInt(top)-this.shadowSize.top+this.shadowShift.top;left=parseInt(left)-this.shadowSize.left+this.shadowShift.left;shadowStyle.top=top+'px';shadowStyle.left=left+'px';if(this.iframe)
this.iframe.setPosition(top,left);}
return this;},setSize:function(width,height){if(this.shadowSize){try{var w=Math.max(0,parseInt(width)+this.shadowSize.width-this.shadowShift.width)+"px";this.shadow.style.width=w;var h=Math.max(0,parseInt(height)-this.shadowShift.height)+"px";this.shadowContents[1].childElements().each(function(e){e.style.height=h});this.shadowContents.each(function(item){item.style.width=w});if(this.iframe)
this.iframe.setSize(width+this.shadowSize.width-this.shadowShift.width,height+this.shadowSize.height-this.shadowShift.height);}
catch(e){}}
return this;},setBounds:function(bounds){return this.setPosition(bounds.top,bounds.left).setSize(bounds.width,bounds.height);},setZIndex:function(zIndex){this.shadow.style.zIndex=zIndex;return this;},show:function(){this.render();this.shadow.show();if(this.iframe)
this.iframe.show();return this;},hide:function(){this.shadow.hide();if(this.iframe)
this.iframe.hide();return this;},remove:function(){this.shadow.remove();return this;},focus:function(){this.options.focus=true;this.updateShadow();return this;},blur:function(){this.options.focus=false;this.updateShadow();return this;},render:function(){if(this.element.parentNode&&!Object.isElement(this.shadow.parentNode)){this.element.parentNode.appendChild(this.shadow);this.computeSize();this.setBounds(Object.extend(this.element.getDimensions(),this.getElementPosition()));this.shadow.show();}
return this;},create:function(){var zIndex=this.element.getStyle('zIndex');if(!zIndex)
this.element.setStyle({zIndex:this.options.zIndex});zIndex=(zIndex||this.options.zIndex)-1;this.shadowContents=new Array(3);this.shadowContents[0]=new Element("div").insert(new Element("div",{className:"shadow_center_wrapper"}).insert(new Element("div",{className:"n_shadow"}))).insert(new Element("div",{className:"shadow_right ne_shadow"})).insert(new Element("div",{className:"shadow_left nw_shadow"}));this.shadowContents[1]=new Element("div").insert(new Element("div",{className:"shadow_center_wrapper c_shadow"})).insert(new Element("div",{className:"shadow_right e_shadow"})).insert(new Element("div",{className:"shadow_left w_shadow"}));this.centerElements=this.shadowContents[1].childElements();this.shadowContents[2]=new Element("div").insert(new Element("div",{className:"shadow_center_wrapper"}).insert(new Element("div",{className:"s_shadow"}))).insert(new Element("div",{className:"shadow_right se_shadow"})).insert(new Element("div",{className:"shadow_left sw_shadow"}));this.shadow=new Element("div",{className:"shadow_container "+this.options.theme,style:"position:absolute; top:-10000px; left:-10000px; display:none; z-index:"+zIndex}).insert(this.shadowContents[0]).insert(this.shadowContents[1]).insert(this.shadowContents[2]);},computeSize:function(){if(this.focusedShadowShift)
return;this.shadow.show();var content=this.shadowContents[1].select("div.c_shadow").first();this.unfocusedShadowShift={};this.focusedShadowShift={};$w("top left bottom right").each(function(pos){this.unfocusedShadowShift[pos]=content.getNumStyle("padding-"+pos)||0}.bind(this));this.unfocusedShadowShift.width=this.unfocusedShadowShift.left+this.unfocusedShadowShift.right;this.unfocusedShadowShift.height=this.unfocusedShadowShift.top+this.unfocusedShadowShift.bottom;$w("top left bottom right").each(function(pos){this.focusedShadowShift[pos]=content.getNumStyle("margin-"+pos)||0}.bind(this));this.focusedShadowShift.width=this.focusedShadowShift.left+this.focusedShadowShift.right;this.focusedShadowShift.height=this.focusedShadowShift.top+this.focusedShadowShift.bottom;this.shadowShift=this.options.focus?this.focusedShadowShift:this.unfocusedShadowShift;this.shadowSize={top:this.shadowContents[0].childElements()[1].getNumStyle("height"),left:this.shadowContents[0].childElements()[1].getNumStyle("width"),bottom:this.shadowContents[2].childElements()[1].getNumStyle("height"),right:this.shadowContents[0].childElements()[2].getNumStyle("width")};this.shadowSize.width=this.shadowSize.left+this.shadowSize.right;this.shadowSize.height=this.shadowSize.top+this.shadowSize.bottom;content.setStyle("padding:0; margin:0");this.shadow.hide();},updateShadow:function(){this.shadowShift=this.options.focus?this.focusedShadowShift:this.unfocusedShadowShift;var shadowStyle=this.shadow.style,pos=this.getElementPosition(),size=this.element.getDimensions();shadowStyle.top=pos.top-this.shadowSize.top+this.shadowShift.top+'px';shadowStyle.left=pos.left-this.shadowSize.left+this.shadowShift.left+'px';shadowStyle.width=size.width+this.shadowSize.width-this.shadowShift.width+"px";var h=size.height-this.shadowShift.height+"px";this.centerElements.each(function(e){e.style.height=h});var w=size.width+this.shadowSize.width-this.shadowShift.width+"px";this.shadowContents.each(function(item){item.style.width=w});},getElementPosition:function(){return{top:this.element.getNumStyle("top"),left:this.element.getNumStyle("left")}}});UI.IframeShim=Class.create(UI.Options,{options:{parent:document.body},initialize:function(options){this.setOptions(options);this.element=new Element('iframe',{style:'position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=1);',src:'javascript:false;',frameborder:0});$(this.options.parent||document.body).insert(this.element);},hide:function(){this.element.hide();return this;},show:function(){this.element.show();return this;},positionUnder:function(element){var element=$(element),offset=element.cumulativeOffset(),dimensions=element.getDimensions(),style={left:offset[0]+'px',top:offset[1]+'px',width:dimensions.width+'px',height:dimensions.height+'px',zIndex:element.getStyle('zIndex')-1};this.element.setStyle(style).show();return this;},setBounds:function(bounds){for(prop in bounds){bounds[prop]=parseInt(bounds[prop])+'px';}
this.element.setStyle(bounds);return this;},setSize:function(width,height){this.element.style.width=parseInt(width)+"px";this.element.style.height=parseInt(height)+"px";return this;},setPosition:function(top,left){this.element.style.top=parseInt(top)+"px";this.element.style.left=parseInt(left)+"px";return this;},destroy:function(){if(this.element)
this.element.remove();return this;}});Object.extend(Event,{KEY_SPACE:32,KEY_COMA:188});UI.AutoComplete=Class.create(UI.Options,{options:{className:"pui-autocomplete",max:{selection:10,selected:false},url:false,delay:0.2,shadow:false,highlight:false,tokens:false,unique:true},initialize:function(element,options){this.setOptions(options);if(typeof(this.options.tokens)=='number')
this.options.tokens=$A([this.options.tokens]);this.element=$(element);this.render();this.updateInputSize();this.nbSelected=0;this.list=[];this.keydownHandler=this.keydown.bindAsEventListener(this);document.observe('keydown',this.keydownHandler);},destroy:function(){this.autocompletion.destroy();this.input.stopObserving();document.stopObserving('keypress',this.keydownHandler);this.container.remove();this.element.show();},init:function(tokens){tokens=tokens||this.options.tokens;var values=this.input.value.split(tokens.first());values.each(function(text){if(!text.empty())this.add(text)}.bind(this));this.input.clear();return this;},add:function(text,value,options){if(!this.canAddMoreItems())
return;var li=new Element("li",Object.extend({className:this.getClassName("box")},options||{}));li.observe("click",this.focus.bindAsEventListener(this,li)).observe("mouseover",this.over.bindAsEventListener(this,li)).observe("mouseout",this.out.bindAsEventListener(this,li));var close=new Element('a',{'href':'#','class':'closebutton'});li.insert(new Element("span").update(text).insert(close));if(value)
li.writeAttribute("pui-autocomplete:value",value);close.observe("click",this.remove.bind(this,li));this.input.parentNode.insert({before:li});this.nbSelected++;this.updateSelectedText().updateHiddenField();this.updateInputSize();if(!this.canAddMoreItems())
this.hideAutocomplete().fire("selection:max_reached");else
this.hideAutocomplete().fire("input:empty");return this.fire("element:added",{element:li,text:text,value:value});},remove:function(element){element.stopObserving();element.remove();this.nbSelected--;this.updateSelectedText().updateHiddenField();this.updateInputSize();this.input.focus();return this.fire("element:removed",{element:element});},removeLast:function(){var element=this.container.select("li."+this.getClassName("box")).last();if(element)
this.remove(element);},removeSelected:function(event){if(event.element().readAttribute("type")!="text"&&event.keyCode==Event.KEY_BACKSPACE){this.container.select("li."+this.getClassName("box")).each(function(element){if(this.isSelected(element))
this.remove(element);}.bind(this));if(event)
event.stop();}
return this;},focus:function(event,element){if(event)
event.stop();if(event&&!event.shiftKey)
this.deselectAll();element=element||this.input;if(element==this.input&&!this.input.readAttribute("focused")){this.input.writeAttribute("focused",true);this.input.focus();this.displayCompletion();}
else{this.out(event,element);element.addClassName(this.getClassName("selected"));if(element!=this.input)
this.blur();}
return this.fire("element:focus",{element:element});},blur:function(event,element){if(event)
event.stop();if(!element)
this.input.blur();this.hideAutocomplete();return this.fire("element:blur",{element:element});},over:function(event,element){if(!this.isSelected(element))
element.addClassName(this.getClassName("over"));if(event)
event.stop();return this.fire("element:over",{element:element});},out:function(event,element){if(!this.isSelected(element))
element.removeClassName(this.getClassName("over"));if(event)
event.stop();return this.fire("element:out",{element:element});},isSelected:function(element){return element.hasClassName(this.getClassName("selected"));},deselectAll:function(){this.container.select("li."+this.getClassName("box")).invoke("removeClassName",this.getClassName("selected"));return this;},setAutocompleteList:function(list){this.list=list;return this;},fire:function(eventName,memo){memo=memo||{};memo.autocomplete=this;return this.input.fire('autocomplete:'+eventName,memo);},observe:function(eventName,handler){this.input.observe('autocomplete:'+eventName,handler.bind(this));return this;},stopObserving:function(eventName,handler){this.input.stopObserving('autocomplete:'+eventName,handler);return this;},moveSelection:function(event,element){var current=null;if(!this.current)
current=this.autocompletionContainer.firstDescendant();else if(element=="next"){current=this.current[element]()||this.autocompletionContainer.firstDescendant();}
else if(element=="previous"){current=this.current[element]()||this.autocompletionContainer.childElements().last();}
else
current=element;if(this.current)
this.current.removeClassName(this.getClassName("current"));this.current=current;if(this.current)
this.current.addClassName(this.getClassName("current"));},addCurrentSelected:function(){if(this.current){var index=this.autocompletionContainer.childElements().indexOf(this.current);this.current=null;this.input.value="";this.add(this.selectedList[index].text,this.selectedList[index].value);(function(){this.input.focus()}.bind(this)).defer();this.displayCompletion();}},showMessage:function(text){if(text){if(this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=false;}
this.message.update(text);this.message.show();this.autocompletionContainer.hide();this.showAutocomplete();}
else
this.hideAutocomplete();},runRequest:function(search){this.autocompletionContainer.hide();this.fire("request:started");new Ajax.Request(this.options.url,{parameters:{search:search,max:this.options.max.selection,"selected[]":this.selectedValues()},onComplete:function(transport){this.setAutocompleteList(transport.responseText.evalJSON());this.timer=null;this.fire("request:completed");this.displayCompletion();}.bind(this)});},getClassName:function(className){return this.options.className+"-"+className;},keydown:function(event){if(event.element()!=this.input)
return;this.ignoreKeyup=false;if(this.options.max.selected&&this.nbSelected==this.options.max.selected)
this.ignoreKeyup=true;if(this.options.tokens){var tokenFound=this.options.tokens.find(function(token){return event.keyCode==token;});if(tokenFound){var value=this.input.value.strip();this.ignoreKeyup=true;var value=this.input.value;this.input.clear();if(!value.empty())
this.add(value);}}
switch(event.keyCode){case Event.KEY_UP:this.moveSelection(event,'previous');this.ignoreKeyup=true;break;case Event.KEY_DOWN:this.moveSelection(event,'next');this.ignoreKeyup=true;break;case Event.KEY_RETURN:this.addCurrentSelected();this.ignoreKeyup=true;break;case Event.KEY_BACKSPACE:if(this.input.getCaretPosition()==0)
this.removeLast();break;}
if(this.ignoreKeyup){event.stop();return false;}
else
return true;},keyup:function(event){if(this.ignoreKeyup){this.ignoreKeyup=false;return true;}
else{this.updateHiddenField();this.displayCompletion(event);return true;}},updateInputSize:function(){var top;var w=this.container.select("li."+this.getClassName("box")).inject(0,function(sum,element){if(Object.isUndefined(top))
top=element.cumulativeOffset().top;else if(top!=element.cumulativeOffset().top){top=element.cumulativeOffset().top;sum=0;}
return sum+element.getWidth()+element.getMarginDimensions().width+element.getBorderDimensions().width;});var margin=this.container.getMarginDimensions().width+this.container.getBorderDimensions().width+this.container.getPaddingDimensions().width;var width=this.container.getWidth()-w-margin;if(width<50)
width=this.container.getWidth()-margin;this.input.parentNode.style.width=width+"px";this.input.style.width=width+"px";},displayCompletion:function(event){var value=this.input.value.strip();this.current=null;if(!this.canAddMoreItems())
return;if(!value.empty()){if(event&&this.options.url){if(this.timer)
clearTimeout(this.timer);this.timer=this.runRequest.bind(this,value).delay(this.options.delay);}
else{this.message.hide();if(this.options.url)
this.selectedList=this.list;else{this.selectedList=this.list.findAll(function(entry){return entry.text.match(value)}).slice(0,this.options.max.selection);if(this.options.unique){var selected=this.selectedValues();if(!selected.empty())
this.selectedList=this.selectedList.findAll(function(entry){return!selected.include(entry.value)});}}
this.autocompletionContainer.update("");if(this.selectedList.empty()){this.hideAutocomplete().fire('selection:empty');}
else{this.selectedList.each(function(entry){var li=new Element("li").update(this.options.highlight?entry.text.gsub(value,"<em>"+value+"</em>"):entry.text);li.observe("mouseover",this.moveSelection.bindAsEventListener(this,li)).observe("mousedown",this.addCurrentSelected.bindAsEventListener(this));this.autocompletionContainer.insert(li);}.bind(this));this.autocompletionContainer.show();this.moveSelection("next");this.showAutocomplete();}}}
else{this.hideAutocomplete().fire("input:empty");}},showAutocomplete:function(event){this.autocompletion.show(event);return this;},hideAutocomplete:function(){if(!this.hideTimer)
this.hideTimer=(function(){this.autocompletionContainer.hide();this.autocompletion.hide();this.hideTimer=false;}).bind(this).defer();return this;},render:function(){this.input=this.element.cloneNode(true);this.input.writeAttribute("autocomplete","off");this.input.name="";this.input.observe("focus",this.focus.bindAsEventListener(this,this.input)).observe("blur",this.blur.bindAsEventListener(this,this.input)).observe("keyup",this.keyup.bindAsEventListener(this));this.container=new Element('ul',{className:this.getClassName("holder")}).insert(new Element("li",{className:this.getClassName("input")}).insert(this.input));this.autocompletionContainer=new Element("ul",{className:this.getClassName("results")}).hide();this.message=new Element("div",{className:this.getClassName("message")}).hide();this.hidden=new Element("input",{type:'hidden',name:this.element.name});this.element.insert({before:this.container}).insert({before:this.hidden});this.element.remove();this.autocompletion=new UI.PullDown(this.container,{className:this.getClassName("result"),shadow:this.options.shadow,position:'below',cloneWidth:true});this.autocompletion.insert(this.message).insert(this.autocompletionContainer);},canAddMoreItems:function(){return!(this.options.max.selected&&this.nbSelected==this.options.max.selected);},updateSelectedText:function(){var selected=this.container.select("li."+this.getClassName("box"));var content=selected.collect(function(element){return element.down("span").firstChild.nodeValue});var separator=this.getSeparatorChar();this.selectedText=content.empty()?false:content.join(separator);return this;},updateHiddenField:function(){var separator=this.getSeparatorChar();this.hidden.value=this.selectedText?this.selectedValues().join(separator):'';},selectedValues:function(){var selected=this.container.select("li."+this.getClassName("box"));return selected.collect(function(element){return element.readAttribute("pui-autocomplete:value")});},getSeparatorChar:function(){var separator=this.options.tokens?this.options.tokens.first():" ";if(separator==Event.KEY_COMA)
separator=',';if(separator==Event.KEY_SPACE)
separator=' ';return separator;}});Element.addMethods({getCaretPosition:function(element){if(element.createTextRange){var r=document.selection.createRange().duplicate();r.moveEnd('character',element.value.length);if(r.text==='')return element.value.length;return element.value.lastIndexOf(r.text);}else return element.selectionStart;},getAttributeDimensions:function(element,attribut){var dim=$w('top bottom left right').inject({},function(dims,key){dims[key]=element.getNumStyle(attribut+"-"+key+(attribut=="border"?"-width":""));return dims;});dim.width=dim.left+dim.right;dim.height=dim.top+dim.bottom;return dim;},getBorderDimensions:function(element){return element.getAttributeDimensions("border")},getMarginDimensions:function(element){return element.getAttributeDimensions("margin")},getPaddingDimensions:function(element){return element.getAttributeDimensions("padding")},clonePosition_new:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=Element.viewportOffset(source);element=$(element);var delta=[0,0];var parent=null;if(Element.getStyle(element,'position')=='absolute'){parent=Element.getOffsetParent_new(element);delta=Element.viewportOffset(parent);}
if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop;}
if(options.setLeft)element.style.left=(p[0]-delta[0]+options.offsetLeft)+'px';if(options.setTop)element.style.top=(p[1]-delta[1]+options.offsetTop)+'px';if(options.setWidth)element.style.width=source.offsetWidth+'px';if(options.setHeight)element.style.height=source.offsetHeight+'px';return element;},getOffsetParent_new:function(element){if(element.offsetParent)return $(element.offsetParent);if(element==document.body)return $(element);while((element=element.parentNode)&&element!=document.body&&Object.isElement(element))
if(Element.getStyle(element,'position')!='static')
return $(element);return $(document.body);}});