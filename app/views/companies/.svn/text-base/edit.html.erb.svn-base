<%i=0%>

<div id="left_content">
  <div class="form_info">
    <h1>编辑公司信息</h1>
    <% form_for(@company) do |f| %>
      <div id="thumb_img">
        <%= img_upload_field(attachments_path(),
          @company.icon_file_path ,
          nil,
          {:button_text=>"上传文件",:post_params=>{:type=>CompanyIcon.to_s},:button_width=>60,:button_height=>18
          }) %>
      </div>

      <%= hidden_field_tag  "company[last_edit_user_id]" ,current_user.to_param %>
      <p>
        <%= f.label :name,"公司名称",:class=>"filed_lab" %>
        <%=  f.text_field(:name) %>
        <%@company.versions.find_version_by_column(:name).each do |version| %>
          <%= link_to_function "版本#{i+=1}","$('company_name').value='#{version.name}'",:title=>"#{version.name}" %>
        <%end%>
      </p>
  <%#*#TODO:所属行业需要优化成 ajax方式 其实一次不需要载入所有的行业信息%>
      <p>
        <%= f.label :industry ,"所属行业",:class=>"filed_lab" %>

        <%= f.select :industry_root_id,IndustryRoot.all.collect {|p| [ p.name, p.id ] },{},:class=>"industry_type"  %>
        <%= f.select :industry_second_id,IndustrySecond.find_all_by_industry_root_id(f.object.industry_root_id).collect {|p| [ p.name, p.id ] } ,
          {},:class=>"industry_type"  %>
        <%=  drop_list("company_industry_root_id","company_industry_second_id",IndustryRoot.all.collect {|p| [ p.id, p.industry_seconds.all.collect{|q| [q.id,q.name] } ] })%>
      </p>

      <p>
        <%= label_tag  :ds ,"&nbsp;",:class=>"filed_lab" %>
        <%= f.select :industry_third_id,IndustryThird.find_all_by_industry_second_id(f.object.industry_second_id).collect {|p| [ p.name, p.id ] } ,
          {},:class=>"industry_type"  %>
        <%=  drop_list("company_industry_second_id","company_industry_third_id",IndustrySecond.all.collect {|p| [ p.id, p.industry_thirds.all.collect{|q| [q.id,q.name] } ] })%>

        <%= f.select :industry_id,Industry.find_all_by_industry_third_id(f.object.industry_third_id).collect {|p| [ p.name, p.id ] },
          {},:class=>"industry_type"   %>
        <%=  drop_list("company_industry_third_id","company_industry_id",IndustryThird.all.collect {|p| [ p.id, p.industries.all.collect{|q| [q.id,q.name] } ] })%>

      </p>
      <p>
        <%= f.label :company_type, "公司类型",:class=>"filed_lab" %>
        <%= f.select :company_type_id,CompanyType.all.collect {|p| [ p.name, p.id ] }  %>
      </p>
      <p>
        <%= f.label :size,"公司规模",:class=>"filed_lab" %>
        <%= f.select :company_size_id,CompanySize.all.collect {|p| [ p.name, p.id ] } %>
      </p>
      <p>
        <%= f.label :fax,"传真",:class=>"filed_lab"  %>
        <%= f.text_field :fax %>
      </p>
      <p>
        <%= f.label :phone,"电话",:class=>"filed_lab"  %>
        <%= f.text_field :phone %>
      </p>
      <p>
        <%= f.label :website,"网站",:class=>"filed_lab"  %>
        <%= f.text_field :website %>
        <%  i=0 %>
        <%@company.versions.find_version_by_column(:website).each do |version| %>

          <%= link_to_function "版本#{i+=1}","$('company_website').value='#{version.website}'",:title=>"#{version.website}" %>
        <%end%>
      </p>
  <%#*<div>%>
  <%# fields_for :CompanyIcon,@company_icon do |icon| %>
  <%#= icon.label :uploaded_data ,"图片" ,:class=>"filed_lab" %>
  <%#= icon.file_field :uploaded_data  %>

  <%#end%>
  <%#*</div>%>

      <p>
        <%  i=0 %>
        <%= f.label :address, "地址",:class=>"filed_lab" %>
        <%= f.select :state_id,State.all.collect {|p| [p.name,p.id]} %>
        <%= f.select :city_id,City.find_all_by_state_id(f.object.state_id).collect {|p| [p.name,p.id]} %>

        <%=  drop_list("company_state_id","company_city_id",State.all.collect {|p| [ p.id, p.cities.all.collect{|q| [q.id,q.name] } ] })%>

        <%= f.text_field(:address) %>
        <%@company.versions.find_version_by_column(:address).each do |version| %>
          <%= link_to_function "版本#{i+=1}","$('company_address').value='#{version.address}'" ,:title=>"#{version.address}"%>
        <%end%>
      </p>
      <p>
        <%  i=0 %>
        <%= f.label :description,"介绍",:class=>"filed_lab"  %>
        <%= f.text_area :description ,:rows=>6%>

        <%@company.versions.find_version_by_column(:description).each do |version| %>
          <%= link_to_function "版本#{i+=1}","$('company_description').value=this.title",:title=>"#{version.description}" %>
    <%#= link_to "×",destroy_version_company_path(:version=>version.id),:method=>:delete %>
        <%end%>
      </p>
      <p>
        <%= f.submit '保存' %> <%= link_to "取消",company_path(@company) %>
      </p>
    <% end %>
  </div>
</div>
<div id="right_content">
  <% sub_block_div() do%>
  <%= link_to "<< 公司首页",company_path(@company) %>
  <p>
    版本的介绍
    鼠标放上去显示详细信息，单击使用该版本
  </p>
<%end%>
</div>